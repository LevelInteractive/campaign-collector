!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CampaignCollector=e():t.CampaignCollector=e()}(this,(()=>(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function s(t,e,s){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var s=t[Symbol.toPrimitive];if(void 0!==s){var i=s.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}function i(t,e,s){o(t,e),e.set(t,s)}function o(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function n(t,e,s){return t.set(r(t,e),s),s}function a(t,e){return t.get(r(t,e))}function r(t,e,s){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:s;throw new TypeError("Private element is not present on this object")}t.d(e,{default:()=>g});var c=new WeakMap,l=new WeakMap,h=new WeakMap,u=new WeakMap,p=new WeakMap,f=new WeakMap,m=new WeakMap,d=new WeakSet;class g{static create(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=new g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return t&&!window.hasOwnProperty(t)&&(window[t]=e),["collect","fillFormFields"].reduce(((t,s)=>(t[s]=e[s].bind(e),t)),{})}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e,g;o(e=this,g=d),g.add(e),i(this,c,"CampaignCollector"),i(this,l,null),i(this,h,{cookieDomain:null,decorateHostnames:[],enableSpaSupport:!1,fieldMap:{$json:"campaign_json",last:{utm:null,$ns:null},first:{utm:null,$ns:null},cookies:{},globals:{}},fieldTargetMethod:["name"],fieldDataAttribute:"data-campaign-collector",filters:{},jars:{google:"^_ga|_gcl_",linkedin:"li_fat_id",meta:"^_fb(?:c|p)",microsoft:"^_uet",x:"_twclid"},namespace:"lvl",parseRules:{organic:{google:"^www.(google).[a-z]{2,3}(?:.[a-z]{2})?$",bing:"^www.(bing).com$",duckduckgo:"^(duckduckgo).com$",yahoo:"^(?:www|m)?.?(yahoo).(?:com|cn)$",ecosia:"^www.(ecosia).org$",ask:"^www.(ask).com$",aol:"^(?:search.)?(aol).com$",baidu:"^www.(baidu).com$",xfinity:"^my|search.(xfinity).com",yandex:"^(?:www.)?(yandex).com|ru$",lycos:"^(?:www|search)?.?(lycos).[a-z]{2,3}(?:.[a-z]{2})?$"},social:{facebook:"^www.(facebook).com$",instagram:"^l.(instagram).com$",linkedin:"^www.(linkedin).com$",x:"^t.co|x.com$"}},reportAnomalies:!1,storageMethod:"cookie",storeAsBase64:!0,touchpoints:{last:{enabled:!0,expires:[30,"minutes"]},first:{enabled:!0,expires:[400,"days"]}}}),i(this,u,{utm:["source","medium","campaign","term","content","id","source_platform","marketing_tactic","creative_format"],$ns:["platform","source","campaign","group","unit","extension","loc_interest","loc_physical","device","matchtype","placement","position","target","network"]}),i(this,p,{utm:["source","medium","campaign"],$ns:["platform","source"]}),i(this,f,null),i(this,m,null),s(this,"params",null),console.time(a(c,this)),this.url=new URL(window.location.href),n(l,this,r(d,this,k).call(this,a(h,this),t)),r(d,this,O).call(this),r(d,this,$).call(this),r(d,this,P).call(this),r(d,this,S).call(this),r(d,this,E).call(this,["utm",a(l,this).namespace]),n(m,this,r(d,this,F).call(this)),r(d,this,W).call(this),r(d,this,w).call(this),window.dataLayer&&window.dataLayer.push({event:"lvl.campaign-collector:ready",campaign:this.collect({applyFilters:!0,jarCookies:!0,without:["globals"]})}),console.timeEnd(a(c,this))}fillFormFields(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.hasOwnProperty("targetMethod")&&(t.targetMethod=Array.isArray(t.targetMethod)?t.targetMethod:[t.targetMethod]);const e={targetMethod:t.targetMethod||this.config.fieldTargetMethod,scope:t.scope||document},s={first:a(m,this).first,last:a(m,this).last};for(let t in a(l,this).fieldMap)if(a(l,this).fieldMap.hasOwnProperty(t))for(let o in a(l,this).fieldMap[t]){if(!a(l,this).fieldMap[t].hasOwnProperty(o))continue;let n,r=a(l,this).fieldMap[t][o],c=[];if(e.targetMethod.forEach((t=>{const e={class:"input."+r,parentClass:"."+r+" input",dataAttribute:"input["+a(l,this).fieldDataAttribute+'="'+r+'"]',name:'input[name="'+r+'"]'};c.push(e[t]||e.name)})),n=e.scope.querySelectorAll(c.join(",")),n)for(var i=0;i<n.length;i++)s[t].hasOwnProperty(o)&&""!=s[t][o]&&(n[i].value=s[t][o],n[i].dispatchEvent(new Event("input",{bubbles:!0})))}}get activeSession(){const t=a(m,this).last;return t?t._expires_at<Date.now()?null:a(m,this).last:null}collect(){let{jarCookies:t=!1,applyFilters:e=!1,without:s=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i={};return s.includes("params")||(i.params=this.params),s.includes("globals")||(i.globals=r(d,this,v).call(this,{applyFilters:e})),s.includes("cookies")||(i.cookies=r(d,this,b).call(this,{applyFilters:e,inJars:t})),i}}function w(){const t=t=>{t.target.matches('[type="submit"]')&&this.fillFormFields(t.target.closest("form"))};if(a(l,this).enableSpaSupport){r(d,this,j).call(this);const t=t=>{r(d,this,P).call(this,!0)};window.addEventListener("popstate",t),window.onpopstate=history.onpushstate=t}document.addEventListener("touchstart",t),document.addEventListener("mousedown",t)}function y(t){const e=this.params[t];if(!Object.keys(e).length)return;const s=a(p,this)[t];for(const t of s)if(!e.hasOwnProperty(t))return!1;return!0}function b(){let{applyFilters:t=!1,inJars:e=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s={};if(!a(l,this).fieldMap.cookies)return s;for(const[n,h]of Object.entries(a(l,this).fieldMap.cookies)){let h=r(d,this,_).call(this,n);if(t&&"function"==typeof a(l,this).filters[n])try{h=a(l,this).filters[n](h)}catch(t){console.error("".concat(a(c,this),'.js: Error applying filter to cookie "').concat(n,'"'),t.message)}if(h)if(e){let t=!0;for(const e in a(l,this).jars){var i;if(new RegExp(a(l,this).jars[e]).test(n)){null!==(i=s[e])&&void 0!==i||(s[e]={}),s[e][n]=h,t=!1;break}}var o;if(t)null!==(o=s._stray)&&void 0!==o||(s._stray={}),s._stray[n]=h}else s[n]=h}return s}function v(){let{applyFilters:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};for(const[s,i]of Object.entries(a(l,this).fieldMap.globals))try{let i=r(d,this,x).call(this,s);t&&"function"==typeof a(l,this).filters[s]&&(i=a(l,this).filters[s](i)),e[s]=i}catch(t){console.error("".concat(a(c,this),'.js: Error resolving global "').concat(s,'"'),t.message)}return e}function k(t,e){for(const s in e)e.hasOwnProperty(s)&&(Array.isArray(e[s])?t[s]=e[s].slice():"object"==typeof e[s]&&null!==e[s]?(t[s]||(t[s]={}),r(d,this,k).call(this,t[s],e[s])):t[s]=e[s]);return t}function _(t){const e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]+)"));return e?e[2].trim():null}function M(){let{value:t=0,units:e="minutes"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s={minutes:60,hours:3600,days:86400,weeks:604800,months:2592e3,years:31536e3}[e.toLowerCase()];return s?parseInt(t)*s*1e3:0}function j(){console.warn("".concat(a(c,this),".js: config.enableSpaSupport = true monkeypatches the the history.pushState() method."));let t=history.pushState;history.pushState=function(e){return"function"==typeof history.onpushstate&&history.onpushstate({state:e}),t.apply(history,arguments)}}function $(){if(a(l,this).cookieDomain)return;const t=this.url.hostname;if("localhost"===t)return"";const e=t.split(".").reverse();let s=[e[1],e[0]].join(".");e.length>2&&e[1].length<=3&&(s=[e[2],s].join(".")),a(l,this).cookieDomain=s}function x(t){return t.split(".").reduce(((t,e)=>t?t[e]:null),window)}function O(){const t=a(l,this).fieldMap;for(const[e,s]of Object.entries(t))if(["first","last"].includes(e))for(const[t,i]of Object.entries(s)){let s={};a(u,this)[t].forEach((i=>{let o="$ns"===t?a(l,this).namespace:t;s[i]="".concat(o,"_").concat(i),"first"==e&&(s[i]+="_1st")}));let o=r(d,this,k).call(this,s,i);"$ns"===t?(a(l,this).fieldMap[e][a(l,this).namespace]=o,delete a(l,this).fieldMap[e][t]):a(l,this).fieldMap[e][t]=o}}function S(){let t=a(u,this).$ns,e=a(p,this).$ns;a(u,this)[a(l,this).namespace]=t,a(p,this)[a(l,this).namespace]=e,delete a(u,this).$ns,delete a(p,this).$ns}function E(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.url.searchParams;let s={};t=t.length>0?t:[a(l,this).namespace];for(const e of t)s[e]={};const i="stray";if(s[i]={},e){for(const[o,n]of e.entries()){let e=!1;for(const i of t)if(o.startsWith(i+"_")){const t=o.slice(i.length+1);a(u,this)[i].includes(t)&&(s[i][t]=n,e=!0);break}e||(s[i][o]=n)}this.params=s}else this.params=s}function P(){let t;t=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?null:document.referrer?new URL(document.referrer):null,n(f,this,t)}function F(){let t={};const e=a(l,this).touchpoints;for(const[i,o]of Object.entries(e)){var s;if(!o.enabled)continue;let e="_".concat(a(l,this).namespace,"-session-").concat(i);t[i]=r(d,this,A).call(this,e),(null===(s=t[i])||void 0===s?void 0:s._expires_at)<Date.now()&&(r(d,this,C).call(this,e),t[i]=null)}return t}function A(t){const e="_".concat(a(l,this).namespace,"-session-").concat(t);let s="cookie"===a(l,this).storageMethod?r(d,this,_).call(this,e):localStorage.getItem(e);return s&&s.startsWith("base64:")&&(s=atob(s.split(":")[1])),s=JSON.parse(s),s}function C(t){const e="".concat(a(l,this).namespace,"-session-").concat(t);return"cookie"===a(l,this).storageMethod?document.cookie="".concat(e,"=; max-age=0; path=/; domain=").concat(a(l,this).cookieDomain):localStorage.removeItem(e)}function D(t,e){const s="_".concat(a(l,this).namespace,"-session-").concat(t),i=Date.now();e._started_at||(e._started_at=i);const[o,n]=a(l,this).touchpoints[t].expires;return e._expires_at=i+r(d,this,M).call(this,{value:o,units:n}),e=JSON.stringify(e),a(l,this).storeAsBase64&&(e="base64:".concat(btoa(e))),"cookie"===a(l,this).storageMethod?document.cookie="".concat(s,"=").concat(e,"; max-age=").concat(e._expires_at,"; path=/; domain=").concat(a(l,this).cookieDomain,"; secure"):localStorage.setItem(s,e)}function W(){const t=a(l,this).namespace,e={utm:{source:"(direct)",medium:"(none)"}};e[t]={},a(u,this).utm.forEach((t=>{["source","medium"].includes(t)||(e.utm[t]=null)})),a(u,this)[t].forEach((s=>{e[t][s]=null}));const s=r(d,this,y).call(this,"utm"),i=r(d,this,y).call(this,t);(s||i)&&(s&&Object.assign(e.utm,this.params.utm),i&&Object.assign(e[t],this.params[t])),Object.assign(e,{}),a(m,this).first?e=a(m,this).last&&"(direct)"===e.utm.source?a(m,this).last:e:(a(m,this).first=e,r(d,this,D).call(this,"first",e)),a(m,this).last=e,r(d,this,D).call(this,"last",e)}return e=e.default})()));