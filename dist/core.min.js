!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CampaignCollector=t():e.CampaignCollector=t()}(this,(()=>(()=>{"use strict";var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>s});class s{#e="CampaignCollector";#t="1.2.0";#s;#n=null;#i=null;#a={consent:{ad_personalization:{status:null,redacts:[]},ad_storage:{status:null,redacts:[]},ad_user_data:{status:null,redacts:[]},analytics_storage:{status:null,redacts:[]}},debug:!1,decorateHostnames:[],enableSpaSupport:!1,fieldMap:{anonymous_id:"$ns_anonymous_id",attribution:"$ns_attribution_json",consent:"$ns_consent_json",first:{utm:null,$ns:null},last:{utm:null,$ns:null},cookies:{},globals:{}},fieldTargetMethod:["name"],fieldDataAttribute:"data-campaign-collector",fillOnLoad:!0,filters:{},firstPartyLeadEndpoint:null,firstPartyCookieEndpoint:null,namespace:"lvl",nullValue:"-",paramMap:null,parseRules:{organic:{google:"^www.(google).[a-z]{2,3}(?:.[a-z]{2})?$",bing:"^www.(bing).com$",duckduckgo:"^(duckduckgo).com$",yahoo:"^(?:www|m)?.?(yahoo).(?:com|cn)$",ecosia:"^www.(ecosia).org$",ask:"^www.(ask).com$",aol:"^(?:search.)?(aol).com$",baidu:"^www.(baidu).com$",xfinity:"^my|search.(xfinity).com",yandex:"^(?:www.)?(yandex).com|ru$",lycos:"^(?:www|search)?.?(lycos).[a-z]{2,3}(?:.[a-z]{2})?$"},ai:{chatgpt:"(chatgpt).com$",gemini:"^(gemini).google.com$",claude:".(claude).ai$",perplexity:".(perplexity).ai$",mistral:".(mistral).ai$",copilot:"^(copilot).microsoft.com$"},social:{facebook:"^www.(facebook).com$",instagram:"(instagram).com$",linkedin:"^www.(linkedin).com$",tiktok:"^www.(tiktok).com$",snapchat:"^www.(snapchat).com$",x:"^t.co|x.com$",pinterest:"^www.(pinterest).com$",reddit:"^www.(reddit).com$",quora:"^www.(quora).com$"}},sdk:null,sessionTimeout:null,storageDomain:null,storageMethod:"cookie",storageNamespace:"cc",storeAsBase64:!0,stripUtmsFromInternalLinks:!1,userDataHash:{city:!1,region:!1,postal_code:!1,country:!1}};#o=null;#r=["group","ad","product","feed","creative","extension","geo_int","geo_phy","target","network","device","matchtype","placement"];#c={utm:["source","medium","campaign","term","content","id","source_platform","marketing_tactic","creative_format",...this.#r],hsa:["cam","grp","ad","kw","tgt","net","mt","src"],$ns:["platform","source","campaign_name","campaign",...this.#r]};#l={utm:["source","medium","campaign"],$ns:["campaign","group","ad"]};#h="(redacted)";#u=null;#d=null;#m={first:{expires:[400,"days"]},last:{expires:[30,"minutes"]}};#f;constructor(e={}){s.canRun()&&(console.time(this.#e),this.#f=new URL(window.location.href),this.#n=this.#p(this.#a,e),this.#g(),this.#y(),this.#w(),this.#b(),this.#$(),this.#_(),this.#k(["utm",this.#n.namespace]),Array.isArray(this.#n.sessionTimeout)&&(this.#m.last.expires=this.#n.sessionTimeout),this.#d=this.#S(),this.#O(),this.#n.fillOnLoad&&this.fill(),this.#C(),this.#v("ready",{clean_url:this.#E(),config:this.#n}),console.timeEnd(this.#e))}static canRun(){return"undefined"!=typeof WeakMap&&"undefined"!=typeof URL&&"undefined"!=typeof localStorage&&"undefined"!=typeof DOMParser}static create(e={},t=null){if(!s.canRun())return;const n=new s(e);return window._campaignCollector=window._campaignCollector||{},t&&!window._campaignCollector.hasOwnProperty(t)&&(window._campaignCollector[t]=n),["fill","grab","lead"].reduce(((e,t)=>(e[t]=n[t].bind(n),e)),{})}static consentChange(e,t){if(!["ad_storage","ad_user_data","analytics_storage","ad_personalization"].includes(e))throw new Error("Consent type invalid");if(!["granted","denied",null].includes(t))throw new Error('Consent status must be "granted", "denied", or null');const s="campaign-collector";document.dispatchEvent(new CustomEvent(`${s}:consent.change`,{detail:{type:e,status:t},bubbles:!0})),document.dispatchEvent(new Event(`${s}:${e}.${t}`,{bubbles:!0}))}get activeSession(){const e=this.#d.last;if(!e)return null;const t=Math.ceil(Date.now()/1e3);if(e._exp<t)return null;if(e._ref){const t=this.#x(e._ref);return t?{...e,[this.#n.namespace]:t[this.#n.namespace],utm:t.utm}:e}return e}get allowedFields(){return this.#c}get anonymousId(){return this.#A("analytics_storage")?this.#s:this.#h}#v(e,t={}){dataLayer=window.dataLayer||[];const s={event:`${this.#L(this.#e)}:${e}`,_cc:t};dataLayer.push(s)}set debug(e=!1){e={1:!0,true:!0,0:!1,false:!1}[`${e}`]??!1,this.#n.debug=e,this.#j("Debug",{type:"warn",data:e?"✓":"✗"})}#j(e,{type:t="log",data:s=null}={}){if("function"==typeof console[t]&&(["error","warn"].includes(t)||this.#n.debug))try{console[t](`${this.#e} -`,e,s)}catch(e){}}fill({targetMethod:e,scope:t}={}){e&&!Array.isArray(e)&&(e=[e]);const s={targetMethod:e||this.#n.fieldTargetMethod,scope:t||document},n=this.#M(this.#n.fieldMap),i=this.grab({without:["params"],applyFilters:!0,dereference:!0}),a=(e,t)=>{e.value&&e.value===t||(e.value=t,e.setAttribute("value",e.value),e.dispatchEvent(new Event("input",{bubbles:!1})))};this.#v("fill",{data:i}),["first","last"].forEach((e=>{n[e]&&(n[e]=this.#P(n[e])),i[e]&&(i[e]=this.#P(i[e]))}));for(const[e,t]of Object.entries(n))if("string"!=typeof t)for(const[n,o]of Object.entries(t)){const t=s.scope.querySelectorAll(this.#D(s.targetMethod,o));if(!t?.length)continue;let r=["cookies","globals"].includes(e)?"":this.#n.nullValue,c=i[e][n]??r;Array.from(t).forEach((e=>a(e,c)))}else{let n=t.replace("$ns",this.#n.storageNamespace);const i=s.scope.querySelectorAll(this.#D(s.targetMethod,n));if(i){const t={anonymous_id:this.anonymousId,consent:JSON.stringify(this.#I()),attribution:this.grab({asJson:!0,dereference:!0,without:["params"]})};Array.from(i).forEach((s=>a(s,t[e])))}}}grab({applyFilters:e=!1,asJson:t=!1,dereference:s=!1,without:n=[]}={}){const i={namespace:this.#n.namespace};return n.includes("anonymous_id")||(i.anonymous_id=this.anonymousId),n.includes("params")||(i.params=this.#o),n.includes("first")||(i.first=this.#d.first),n.includes("last")||(i.last=this.#d.last,s&&this.#d.last._ref&&(i.last=Object.assign(this.#d[this.#d.last._ref],i.last))),n.includes("globals")||(i.globals=this.#N({applyFilters:e})),n.includes("cookies")||(i.cookies=this.#R({applyFilters:e})),t?JSON.stringify(i):i}async#F(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map((e=>e.toString(16).padStart(2,"0"))).join("")}lead(e={},t={}){if(!this.#n.firstPartyLeadEndpoint)throw new Error("Endpoint undefined");let s={anonymous_id:this.anonymousId,sent_at:(new Date).getTime(),transport:"beacon",event:"lead",consent:this.#I(),context:{attribution:this.grab({without:["anonymous_id","params","globals"]}),locale:navigator.language,page:{title:document.title,url:location.href,referrer:document.referrer},screen:{width:screen.width,height:screen.height,inner_width:innerWidth,inner_height:innerHeight},sdk:`${this.#e}@${this.#t}`,user_agent:navigator.userAgent}};this.#n.sdk&&(s.context.sdk+=`/${this.#n.sdk}`),Object.keys(e).forEach((t=>{/^[a-z_]+$/.test(t)||(this.#j(`✗ "${t}" != snake_case`,{type:"warn",data:e[t]}),delete e[t])})),Object.keys(e).length>0&&(s.properties=e),["first_name","last_name","email","phone","city","region","postal_code","country","date_of_birth","gender"].forEach((e=>{t[e]&&(s.hasOwnProperty("user")||(s.user={}),s.user[e]=t[e].trim().toLowerCase(),delete t[e])})),this.#z(`https://${this.#n.firstPartyLeadEndpoint}`,s)}async#z(e,t){try{if(t.user){const e=[...Object.keys(this.#n.userDataHash).filter((e=>this.#n.userDataHash[e])),"first_name","last_name","email","phone","date_of_birth","gender"],s={},n={first_name:e=>e.replace(/[^a-z]/g,""),last_name:e=>e.replace(/[^a-z]/g,""),email:e=>{let[t,n]=e.split("@");s.email_domain=n;let i=[e];return["gmail.com","googlemail.com"].includes(n)&&(t=t.replace(/\./g,""),t=t.split("+")[0],i.push(t+"@"+n)),i},phone:e=>{if((e=e.replace(/[^0-9]/g,"")).length<10||e.length>11)return null;if("1"!==e[0]&&11===e.length)return null;const t=[e=10===e.length?`1${e}`:`${e}`,`+${e}`];return s.phone_area_code=e.substring(1,4),t},city:e=>e.replace(/[^a-z]/g,""),postal_code:e=>e.replace(/[^0-9]/g,"").substring(0,5),date_of_birth:e=>{const t=new Date(e);return s.age=`${Math.floor((new Date-t)/315576e5)}`,t.toISOString().split("T")[0].replace("-","")},gender:e=>e.substring(0,1)},i=(await Promise.all(Object.entries(t.user).map((async([t,s])=>{if(!s)return null;if(s.match(/^[0-9a-fA-F]{64}$/))return s;let i=n[t]?n[t](s):s;if(!i)return null;if(Array.isArray(i)){const s=await Promise.all(i.map((async s=>e.includes(t)?await this.#F(s):s)));return s.some((e=>e))?[t,s]:null}{const s=e.includes(t)?await this.#F(i):i;return s?[t,s]:null}})))).filter((e=>null!==e));i.length>0?t.user=Object.assign(Object.fromEntries(i),s):t.user={}}const s=JSON.stringify(t);if(navigator.sendBeacon(e,btoa(s)))return;t.transport="fetch";const n=await fetch(e,{method:"POST",body:btoa(s),keepalive:!0});if(!n.ok)throw new Error(`Status ${n.status}`)}catch(e){throw new Error(`#send(): ${e.message}`)}}#U(e,t){if("function"!=typeof e)return t;try{t=e(t)}catch(e){this.#j("applyFilter:",{type:"error",data:{msg:e.message,value:t}})}return t}#C(){if(this.#n.enableSpaSupport){this.#T();const e=e=>{this.#$(!0),this.#O()};window.addEventListener("popstate",e),window.onpopstate=history.onpushstate=e}document.addEventListener("click",(e=>{const t=e.target.closest("a[href]");if(!t)return;const s=new URL(t.href);if(s.hostname.includes(this.#n.storageDomain)){if(this.#n.stripUtmsFromInternalLinks){if(!s.search.includes("utm_"))return;this.#c.utm.forEach((e=>{s.searchParams.delete(`utm_${e}`)}))}}else{if(!this.#n.decorateHostnames.some((e=>s.hostname.includes(e)||s.hostname===e)))return;const e=this.#P(this.activeSession);for(const[t,n]of Object.entries(e))t.startsWith("_")||s.searchParams.set(t,n)}t.href=s.href}),!0);const e=((e,t)=>{let s,n=!0;return function(...i){if(n)return n=!1,void e(...i);clearTimeout(s),s=setTimeout((()=>{clearTimeout(s),e(...i)}),t)}})((e=>{const t=e.target.closest("form");t&&this.fill({scope:t})}),1e3);["mousedown","touchstart"].forEach((t=>{document.addEventListener(t,(t=>{e(t),this.#W()}))}));const t=this.#L(this.#e);document.addEventListener(`${t}:consent.change`,(e=>{const{type:t,status:s}=e.detail;this.#G(t,s)})),document.addEventListener(`${t}:analytics_storage.denied`,(e=>{this.#b()}))}#H(e){const t=this.#o[e];if(!Object.keys(t).length)return;const s=this.#l[e];for(const e of s)if(!t.hasOwnProperty(e))return!1;return!0}#R({applyFilters:e=!1}={}){let t={};if(!this.#n.fieldMap.cookies)return t;for(const[s,n]of Object.entries(this.#n.fieldMap.cookies)){let n=this.#J(s);n&&((this.#K("ad_storage",s)||this.#K("analytics_storage",s))&&(n=this.#h),n!==this.#h&&e&&(n=this.#U(this.#n.filters[s],n))),n=this.#q(n),t[s]=n}return t}#N({applyFilters:e=!1}={}){let t={};for(const[s,n]of Object.entries(this.#n.fieldMap.globals))if(this.#A("analytics_storage")||!s.startsWith("navigator")&&!["screen"].includes(s))try{let n=this.#B(s);if(!n)continue;e&&(n=this.#U(this.#n.filters[s],n)),n=this.#q(n,{maxLength:1024}),t[s]=n}catch(e){this.#j("resolveGlobal:",{type:"error",data:e.message})}else t[s]=this.#h;return t}#A(e){return{granted:!0,denied:!1,null:!0,null:!0}[this.#n.consent[e].status]}#K(e,t){const s=this.#A(e);return s?!s:this.#n.consent[e].redacts.includes(t)}#G(e,t){this.#n.consent[e].status=t?t.toLowerCase():null}#I(){return Object.entries(this.#n.consent).reduce(((e,[t,s])=>(e[t]=s.status,e)),{})}#M(e){return JSON.parse(JSON.stringify(e))}#p(e,t){for(const s in t)t.hasOwnProperty(s)&&(Array.isArray(t[s])?e[s]=t[s].slice():"object"==typeof t[s]&&null!==t[s]?(e[s]||(e[s]={}),this.#p(e[s],t[s])):e[s]=t[s]);return e}#P(e,t=""){return Object.keys(e).reduce(((s,n)=>{const i=t.length?`${t}_`:"";return"object"!=typeof e[n]||null===e[n]||Array.isArray(e[n])?s[`${i}${n}`]=e[n]:Object.assign(s,this.#P(e[n],`${i}${n}`)),s}),{})}#D(e=[],t){return e.map((e=>{const s={class:`input.${t}, textarea.${t}`,parentClass:`.${t} input, .${t} textarea `,dataAttribute:`input[${this.#n.fieldDataAttribute}="${t}"], textarea[${this.#n.fieldDataAttribute}="${t}"]`,name:`input[name="${t}"], textarea[name="${t}"]`};return s[e]||s.name})).join(",")}#J(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2].trim():null}#V(e){document.cookie=`${e}=; max-age=0; path=/; domain=${this.#n.storageDomain}`}#Z({value:e=0,units:t="minutes"}={}){const s={minutes:60,hours:3600,days:86400,weeks:604800,months:2592e3,years:31536e3}[t.toLowerCase()];return s?parseInt(e)*s:0}#O(){const e=this.#d.last;e&&e._exp<Math.ceil(Date.now()/1e3)&&this.#X("last");const t=this.#n.namespace;let s={utm:{source:"(direct)",medium:"(none)"}};s[t]={};const n=this.#H("utm"),i=this.#H(t);if(n||i)n&&Object.assign(s.utm,this.#o.utm),i&&Object.assign(s[t],this.#o[t]);else{const e=this.activeSession,n=(e,t)=>!(!e||!this.#l[t])&&this.#l[t].every((s=>e[t]?.[s]&&(!["utm"].includes(t)||"source"===s&&"(direct)"!==e[t][s]||"medium"===s&&"(none)"!==e[t][s]))),i=n(e,"utm"),a=n(e,t);i||a?s=e:Object.assign(s.utm,this.#Q())}this.#d?.first?s=this.#d.last&&"(direct)"===s.utm.source?this.#d.last:s:(this.#d.first=s,this.#Y("first",s),s={_ref:"first"}),this.#d.last=s,this.#Y("last",s)}#T(){this.#j("monkeypatching pushState()",{type:"warn"});let e=history.pushState;history.pushState=function(t){return"function"==typeof history.onpushstate&&history.onpushstate({state:t}),e.apply(history,arguments)}}#Q(){let e={};if(!this.#u||this.#u.hostname.indexOf(this.#n.storageDomain)>-1)return e;e={source:this.#u.hostname,medium:"referral"};for(const[t,s]of Object.entries(this.#n.parseRules)){for(const[n,i]of Object.entries(s))if(this.#u.hostname.match(i)){e.source=n,e.medium=`${t}`;break}if(Object.keys(s).indexOf(e.medium)>-1)break}return e}#w(){if(this.#n.storageDomain)return;const e=this.#f.hostname;if("localhost"===e)return"";const t=e.split(".");this.#n.storageDomain=t.length<=2?e:t.slice(-2).join(".")}#B(e){const[t,s]=e.split(".");return s?[t,s].reduce(((e,t)=>e?e[t]:null),window):"window"===t?null:window[t]??null}#ee(e,t=10){let s,n=0;do{s=e;try{e=decodeURIComponent(e),n++}catch(e){break}}while(s!==e&&n<t);return e}#q(e,{maxLength:t=255}={}){if("string"!=typeof e||!e)return"";let s=String(e).trim();s=this.#ee(s);if(s=(new DOMParser).parseFromString(s,"text/html").body.textContent||"",s.startsWith("{")&&s.endsWith("}"))try{return s=JSON.stringify(JSON.parse(s)),s}catch(e){}return s=s.replace(/['"<>]/g,""),s=s.replace(/[^a-zA-Z0-9_\-%.?@#&+~$!:;,=/|{}\[\]\(\) ]/g,""),(s.startsWith("http")||s.startsWith("/"))&&s.includes("?")&&(s=encodeURI(s)),s=s.slice(0,t),s}#S(){let e={};const t=Math.ceil(Date.now()/1e3);for(const[s,n]of Object.entries(this.#m))e[s]=this.#x(s),"cookie"!==this.#n.storageMethod&&e[s]?._exp<t&&(this.#X(s),e[s]=null);return e}#b(){const e=`_${this.#n.storageNamespace}_anonymous_id`;if(this.#s=this.#J(e),!this.#A("analytics_storage"))return this.#s=this.#h,void this.#V(e);this.#s?.startsWith("CC.")||(this.#s=`CC.1.${Date.now()}.${Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}`),"cookie"===this.#n.storageMethod?document.cookie=`${e}=${this.#s}; max-age=${this.#Z({value:400,units:"days"})}; path=/; domain=${this.#n.storageDomain}; secure`:localStorage.setItem(e,this.#s)}#E(){const e=new URL(location.href),t=e.searchParams,s=[];if(t)for(const[e,n]of t.entries())(e.startsWith(`${this.#n.namespace}_`)||e.startsWith("hsa_"))&&s.push(e);return s.forEach((e=>t.delete(e))),this.#i=e.toString(),this.#i}#y(){const e=this.#n.fieldMap;for(const[t,s]of Object.entries(e))if(["first","last"].includes(t))for(const[e,n]of Object.entries(s)){let s={};this.#c[e].forEach((n=>{let i="$ns"===e?this.#n.namespace:e;s[n]=`${i}_${n}`,"first"==t&&(s[n]+="_1st")}));let i=this.#p(s,n);"$ns"===e?(this.#n.fieldMap[t][this.#n.namespace]=i,delete this.#n.fieldMap[t][e]):this.#n.fieldMap[t][e]=i}}#_(){let e=this.#c.$ns,t=this.#l.$ns;this.#c[this.#n.namespace]=e,this.#l[this.#n.namespace]=t,delete this.#c.$ns,delete this.#l.$ns}#k(e=[]){const t=this.#f.searchParams;if(this.#n.paramMap){const e=Array.from(t.keys());for(const s of e){if(!this.#n.paramMap.hasOwnProperty(s))continue;const e=t.get(s);e&&(t.set(this.#n.paramMap[s],e),t.delete(s))}}let s={};e=e.length>0?e:[this.#n.namespace],this.#f.search.includes("hsa_")&&e.push("hsa");for(const t of e)s[t]={};const n="stray";if(s[n]={},t){for(const[i,a]of t.entries()){let t=!1;for(const n of e)if(i.startsWith(n+"_")){const e=i.slice(n.length+1);this.#c[n].includes(e)&&(s[n][e]=this.#q(a),t=!0);break}t||(s[n][i]=this.#q(a))}if(s.hasOwnProperty("hsa")){const e={net:"$ns.platform",src:"$ns.network",cam:"$ns.campaign",grp:"$ns.group",ad:"$ns.ad",tgt:"$ns.target",mt:"$ns.matchtype",kw:"utm.term"};for(const[t,n]of Object.entries(s.hsa)){if(!n||!e.hasOwnProperty(t))continue;let[i,a]=e[t].split(".");i=i.replace("$ns",this.#n.namespace),s[i].hasOwnProperty(a)||(s[i][a]="platform"==a?{adwords:"google",facebook:"meta"}[n]??n:n)}delete s.hsa}this.#o=s}else this.#o=s}#$(e=!1){let t;t=e?null:document.referrer?new URL(document.referrer):null,this.#u=t}#X(e){const t=this.#te(e);this.#d[e]=null,"cookie"===this.#n.storageMethod?document.cookie=`${t}=; max-age=0; path=/; domain=${this.#n.storageDomain}`:localStorage.removeItem(t)}#x(e){const t=this.#te(e);let s="cookie"===this.#n.storageMethod?this.#J(t):localStorage.getItem(t);return s?(s.startsWith("$:")&&(s=atob(s.split(":")[1])),s=JSON.parse(s),"null"===s&&(s=null),s):null}#W(){let e=this.#x("last");e&&this.#Y("last",e)}#Y(e,t){const s=Math.ceil(Date.now()/1e3);t._set||(t._set=s);const[n,i]=this.#m[e].expires,a=this.#Z({value:n,units:i});t._exp=a+s,this.#d[e]=t,t=JSON.stringify(t),this.#n.storeAsBase64&&(t=`$:${btoa(t)}`);const o=this.#te(e);"cookie"===this.#n.storageMethod?document.cookie=`${o}=${t}; max-age=${a}; path=/; domain=${this.#n.storageDomain}; secure`:localStorage.setItem(o,t)}#g(){let e=this.#n.namespace.toLowerCase().trim();if("lvl"==e)return;[/[a-z]{2,4}/.test(e),"utm"!==e].includes(!1)&&(this.#j("Bad namespace: Reverting to `lvl`",{type:"warn"}),this.#n.namespace="lvl")}#te(e){return`_${this.#n.storageNamespace}_${e}`}#L(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}return t=t.default})()));