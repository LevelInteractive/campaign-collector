!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CampaignCollector=e():t.CampaignCollector=e()}(this,(()=>(()=>{"use strict";var t={d:(e,i)=>{for(var s in i)t.o(i,s)&&!t.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:i[s]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function i(t,e,i){s(t,e),e.set(t,i)}function s(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function n(t,e){return t.get(a(t,e))}function o(t,e,i){return t.set(a(t,e),i),i}function a(t,e,i){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:i;throw new TypeError("Private element is not present on this object")}t.d(e,{default:()=>v});var c=new WeakMap,r=new WeakMap,l=new WeakMap,h=new WeakMap,u=new WeakMap,f=new WeakMap,d=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,w=new WeakMap,y=new WeakMap,b=new WeakSet;class v{static create(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=new v(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return t&&!window.hasOwnProperty(t)&&(window[t]=e),["fill","grab"].reduce(((t,i)=>(t[i]=e[i].bind(e),t)),{})}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e,v;s(e=this,v=b),v.add(e),i(this,c,"CampaignCollector"),i(this,r,"1.0.0"),i(this,l,void 0),i(this,h,null),i(this,u,{cookieDomain:null,decorateHostnames:[],enableSpaSupport:!1,fieldMap:{client_id:"$ns_client_id",json:"$ns_attribution_json",first:{utm:null,$ns:null},last:{utm:null,$ns:null},cookies:{},globals:{}},fieldTargetMethod:["name"],fieldDataAttribute:"data-campaign-collector",filters:{},firstPartyLeadEndpoint:null,firstPartyCookieEndpoint:null,namespace:"lvl",parseRules:{organic:{google:"^www.(google).[a-z]{2,3}(?:.[a-z]{2})?$",bing:"^www.(bing).com$",duckduckgo:"^(duckduckgo).com$",yahoo:"^(?:www|m)?.?(yahoo).(?:com|cn)$",ecosia:"^www.(ecosia).org$",ask:"^www.(ask).com$",aol:"^(?:search.)?(aol).com$",baidu:"^www.(baidu).com$",xfinity:"^my|search.(xfinity).com",yandex:"^(?:www.)?(yandex).com|ru$",lycos:"^(?:www|search)?.?(lycos).[a-z]{2,3}(?:.[a-z]{2})?$"},social:{facebook:"^www.(facebook).com$",instagram:"(instagram).com$",linkedin:"^www.(linkedin).com$",tiktok:"^www.(tiktok).com$",snapchat:"^www.(snapchat).com$",x:"^t.co|x.com$",pinterest:"^www.(pinterest).com$",reddit:"^www.(reddit).com$",quora:"^www.(quora).com$"}},reportAnomalies:!1,sessionTimeout:null,storageMethod:"cookie",storageNamespace:"cc",storeAsBase64:!0}),i(this,f,null),i(this,d,{utm:["source","medium","campaign","term","content","id","source_platform","marketing_tactic","creative_format"],$ns:["platform","source","campaign_name","campaign","group","ad","product","feed","creative","extension","geo_int","geo_phy","target","network","device","matchtype","placement"]}),i(this,p,{utm:["source","medium","campaign"],$ns:["platform","campaign","group","ad"]}),i(this,m,null),i(this,g,null),i(this,w,{first:{expires:[400,"days"]},last:{expires:[30,"minutes"]}}),i(this,y,void 0),o(y,this,new URL(window.location.href)),o(h,this,a(b,this,S).call(this,n(u,this),t)),a(b,this,Z).call(this),a(b,this,I).call(this),a(b,this,z).call(this),a(b,this,k).call(this),a(b,this,B).call(this),a(b,this,R).call(this),a(b,this,q).call(this,["utm",n(h,this).namespace]),Array.isArray(n(h,this).sessionTimeout)&&(n(w,this).last.expires=n(h,this).sessionTimeout),o(g,this,a(b,this,F).call(this)),a(b,this,C).call(this),this.fill(),a(b,this,j).call(this),window.dataLayer&&window.dataLayer.push({event:"lvl.campaign-collector:ready",campaign:this.grab({applyFilters:!0,without:["globals"]})})}get activeSession(){const t=n(g,this).last;if(!t)return null;const e=Math.ceil(Date.now()/1e3);if(t._exp<e&&(a(b,this,H).call(this,"last"),a(b,this,C).call(this)),t._ref){const e=a(b,this,U).call(this,t._ref);if(!e)return t;t.lvl=e.lvl,t.utm=e.utm}return t}get allowedFields(){return n(d,this)}fill(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.hasOwnProperty("targetMethod")&&(t.targetMethod=Array.isArray(t.targetMethod)?t.targetMethod:[t.targetMethod]);const e={targetMethod:t.targetMethod||n(h,this).fieldTargetMethod,scope:t.scope||document},i=a(b,this,A).call(this,n(h,this).fieldMap),s=this.grab({without:["params"]});["first","last"].forEach((t=>{i[t]&&(i[t]=a(b,this,x).call(this,i[t])),s[t]&&(s[t]=a(b,this,x).call(this,s[t]))}));for(const[t,c]of Object.entries(i))if("string"!=typeof c)for(const[i,n]of Object.entries(c)){var o;const c=e.scope.querySelectorAll(a(b,this,W).call(this,e.targetMethod,n));if(null==c||!c.length)continue;const r=null!==(o=s[t][i])&&void 0!==o?o:"-";Array.from(c).forEach((t=>{t.value=r,t.setAttribute("value",r),t.dispatchEvent(new Event("input",{bubbles:!0}))}))}else{let i=c.replace("$ns",n(h,this).namespace);const s=e.scope.querySelectorAll(a(b,this,W).call(this,e.targetMethod,i));if(s){const e={client_id:n(l,this),json:this.grab({asJson:!0,without:["params"]})};Array.from(s).forEach((i=>{i.value=e[t],i.setAttribute("value",e[t]),i.dispatchEvent(new Event("input",{bubbles:!0}))}))}}}grab(){let{applyFilters:t=!1,asJson:e=!1,without:i=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s={};return i.includes("client_id")||(s.client_id=n(l,this)),i.includes("params")||(s.params=n(f,this)),i.includes("first")||(s.first=n(g,this).first),i.includes("last")||(s.last=n(g,this).last),i.includes("globals")||(s.globals=a(b,this,E).call(this,{applyFilters:t})),i.includes("cookies")||(s.cookies=a(b,this,$).call(this,{applyFilters:t})),e?JSON.stringify(s):s}lead(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!n(h,this).firstPartyLeadEndpoint)throw new Error("`firstPartyLeadEndpoint` is required to send lead payload.");let i={meta:{client_id:n(l,this),timestamp:Date.now(),screen:[screen.width,screen.height],viewport:[innerWidth,innerHeight],language:navigator.language,user_agent:navigator.userAgent,via:"".concat(n(c,this),"@").concat(n(r,this))},user:{},properties:{},attribution:this.grab({without:["client_id","params"]})};Object.keys(t).forEach((e=>{/^[a-z_]+$/.test(e)||delete t[e]})),["form_id","form_name","form_provider"].forEach((e=>{t[e]&&(i.meta[e]=a(b,this,T).call(this,t[e])),delete t[e]})),["first_name","last_name","email","phone","city","region","postal_code","country"].forEach((t=>{e[t]&&(i.user[t]=e[t].trim().toLowerCase(),"email"===t&&(i.user.email_domain=e[t].split("@")[1]),delete e[t])})),i.properties=t,a(b,this,M).call(this,"https://".concat(n(h,this).firstPartyLeadEndpoint),i)}}function k(){const t="_".concat(n(h,this).storageNamespace,"_cid");o(l,this,a(b,this,D).call(this,t)),n(l,this)||o(l,this,"CC.1.".concat(Date.now(),".").concat(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),"cookie"===n(h,this).storageMethod?document.cookie="".concat(t,"=").concat(n(l,this),"; max-age=").concat(a(b,this,P).call(this,{value:400,units:"days"}),"; path=/; domain=").concat(n(h,this).cookieDomain,"; secure"):localStorage.setItem(t,n(l,this))}async function _(t){const e=(new TextEncoder).encode(t),i=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(i)).map((t=>t.toString(16).padStart(2,"0"))).join("")}async function M(t,e){if(console.log(e),0===Object.keys(e.user).length)return void navigator.sendBeacon(t,btoa(JSON.stringify(e)));const i=["first_name","last_name","email","phone","city","postal_code","date_of_birth","gender"],s={phone:t=>(t=t.replace(/[^0-9]/g,"")).length<10||t.length>11||"1"!==t[0]&&11===t.length?null:[t=10===t.length?"1".concat(t):"".concat(t),"+".concat(t)],city:t=>t.replace(/[^a-z]/g,""),region:t=>2!==t.length?null:t,country:t=>2!==t.length?null:t},n=(await Promise.all(Object.entries(e.user).map((async t=>{let[e,n]=t;if(!n)return null;let o=s[e]?s[e](n):n;if(!o)return null;if(Array.isArray(o)){const t=await Promise.all(o.map((async t=>i.includes(e)?await a(b,this,_).call(this,t):t)));return t.some((t=>t))?[e,t]:null}{const t=i.includes(e)?await a(b,this,_).call(this,o):o;return t?[e,t]:null}})))).filter((t=>null!==t));n.length>0?e.user=Object.fromEntries(n):e.user={},navigator.sendBeacon(t,btoa(JSON.stringify(e)))}function j(){if(n(h,this).enableSpaSupport){a(b,this,L).call(this);const t=t=>{a(b,this,B).call(this,!0),a(b,this,C).call(this)};window.addEventListener("popstate",t),window.onpopstate=history.onpushstate=t}const t=t=>{const e=t.target.closest("form");e&&this.fill(e)};["mousedown","touchstart"].forEach((e=>{document.addEventListener(e,(e=>{t(e),a(b,this,G).call(this)}))}))}function O(t){const e=n(f,this)[t];if(!Object.keys(e).length)return;const i=n(p,this)[t];for(const t of i)if(!e.hasOwnProperty(t))return!1;return!0}function $(){let{applyFilters:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};if(!n(h,this).fieldMap.cookies)return e;for(const[i,s]of Object.entries(n(h,this).fieldMap.cookies)){let s=a(b,this,D).call(this,i);if(s){if(t&&"function"==typeof n(h,this).filters[i])try{s=n(h,this).filters[i](s)}catch(t){console.error("".concat(n(c,this),'.js: Error applying filter to cookie "').concat(i,'"'),t.message)}e[i]=s}}return e}function E(){let{applyFilters:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};for(const[i,s]of Object.entries(n(h,this).fieldMap.globals))try{let s=a(b,this,J).call(this,i);if(!s)continue;t&&"function"==typeof n(h,this).filters[i]&&(s=n(h,this).filters[i](s)),e[i]=s}catch(t){console.error("".concat(n(c,this),'.js: Error resolving global "').concat(i,'"'),t.message)}return e}function A(t){return JSON.parse(JSON.stringify(t))}function S(t,e){for(const i in e)e.hasOwnProperty(i)&&(Array.isArray(e[i])?t[i]=e[i].slice():"object"==typeof e[i]&&null!==e[i]?(t[i]||(t[i]={}),a(b,this,S).call(this,t[i],e[i])):t[i]=e[i]);return t}function x(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object.keys(t).reduce(((i,s)=>{const n=e.length?"".concat(e,"_"):"";return"object"!=typeof t[s]||null===t[s]||Array.isArray(t[s])?i["".concat(n).concat(s)]=t[s]:Object.assign(i,a(b,this,x).call(this,t[s],"".concat(n).concat(s))),i}),{})}function W(){let t=arguments.length>1?arguments[1]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>{const i={class:"input."+t,parentClass:"."+t+" input",dataAttribute:"input["+n(h,this).fieldDataAttribute+'="'+t+'"]',name:'input[name="'+t+'"]'};return i[e]||i.name})).join(",")}function D(t){const e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]+)"));return e?e[2].trim():null}function P(){let{value:t=0,units:e="minutes"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i={minutes:60,hours:3600,days:86400,weeks:604800,months:2592e3,years:31536e3}[e.toLowerCase()];return i?parseInt(t)*i:0}function C(){var t;const e=n(h,this).namespace;let i={utm:{source:"(direct)",medium:"(none)"}};i[e]={};const s=a(b,this,O).call(this,"utm"),o=a(b,this,O).call(this,e);s&&Object.assign(i.utm,n(f,this).utm),o&&Object.assign(i[e],n(f,this)[e]),s||o||Object.assign(i.utm,a(b,this,N).call(this)),null!==(t=n(g,this))&&void 0!==t&&t.first?i=n(g,this).last&&"(direct)"===i.utm.source?n(g,this).last:i:(n(g,this).first=i,a(b,this,X).call(this,"first",i),i={_ref:"first"}),n(g,this).last=i,a(b,this,X).call(this,"last",i)}function L(){console.warn("".concat(n(c,this),".js: config.enableSpaSupport = true monkeypatches the the history.pushState() method."));let t=history.pushState;history.pushState=function(e){return"function"==typeof history.onpushstate&&history.onpushstate({state:e}),t.apply(history,arguments)}}function N(){let t={};if(!n(m,this)||n(m,this).hostname.indexOf(n(h,this).cookieDomain)>-1)return t;t={source:n(m,this).hostname,medium:"referral"};for(const[e,i]of Object.entries(n(h,this).parseRules)){for(const[s,o]of Object.entries(i))if(n(m,this).hostname.match(o)){t.source=s,t.medium="".concat(e);break}if(Object.keys(i).indexOf(t.medium)>-1)break}return t}function z(){if(n(h,this).cookieDomain)return;const t=n(y,this).hostname;if("localhost"===t)return"";const e=t.split(".").reverse();let i=[e[1],e[0]].join(".");e.length>2&&e[1].length<=3&&(i=[e[2],i].join(".")),n(h,this).cookieDomain=i}function J(t){return t.split(".").reduce(((t,e)=>t?t[e]:null),window)}function T(t){if(!t)return"";let e=String(t).trim();e=e.slice(0,255),e=e.replace(/[^a-zA-Z0-9_\-%.@+~$!:=;/|\[\]\(\) ]/g,"");return[/--|;/g,/\/\*|\*\//g].forEach((t=>{e=e.replace(t,"")})),e}function F(){let t={};const e=Math.ceil(Date.now()/1e3);for(const[s,o]of Object.entries(n(w,this))){var i;t[s]=a(b,this,U).call(this,s),"cookie"!==n(h,this).storageMethod&&(null===(i=t[s])||void 0===i?void 0:i._exp)<e&&(a(b,this,H).call(this,s),t[s]=null)}return t}function I(){const t=n(h,this).fieldMap;for(const[e,i]of Object.entries(t))if(["first","last"].includes(e))for(const[t,s]of Object.entries(i)){let i={};n(d,this)[t].forEach((s=>{let o="$ns"===t?n(h,this).namespace:t;i[s]="".concat(o,"_").concat(s),"first"==e&&(i[s]+="_1st")}));let o=a(b,this,S).call(this,i,s);"$ns"===t?(n(h,this).fieldMap[e][n(h,this).namespace]=o,delete n(h,this).fieldMap[e][t]):n(h,this).fieldMap[e][t]=o}}function R(){let t=n(d,this).$ns,e=n(p,this).$ns;n(d,this)[n(h,this).namespace]=t,n(p,this)[n(h,this).namespace]=e,delete n(d,this).$ns,delete n(p,this).$ns}function q(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=n(y,this).searchParams;let i={};t=t.length>0?t:[n(h,this).namespace];for(const e of t)i[e]={};const s="stray";if(i[s]={},e){for(const[o,c]of e.entries()){let e=!1;for(const s of t)if(o.startsWith(s+"_")){const t=o.slice(s.length+1);n(d,this)[s].includes(t)&&(i[s][t]=a(b,this,T).call(this,c),e=!0);break}e||(i[s][o]=a(b,this,T).call(this,c))}o(f,this,i)}else o(f,this,i)}function B(){let t;t=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?null:document.referrer?new URL(document.referrer):null,o(m,this,t)}function H(t){const e=a(b,this,K).call(this,t);n(g,this)[t]=null,"cookie"===n(h,this).storageMethod?document.cookie="".concat(e,"=; max-age=0; path=/; domain=").concat(n(h,this).cookieDomain):localStorage.removeItem(e)}function U(t){const e=a(b,this,K).call(this,t);let i="cookie"===n(h,this).storageMethod?a(b,this,D).call(this,e):localStorage.getItem(e);return i?(i.startsWith("$:")&&(i=atob(i.split(":")[1])),i=JSON.parse(i),"null"===i&&(i=null),i):null}function G(){let t=a(b,this,U).call(this,"last");t&&a(b,this,X).call(this,"last",t)}function X(t,e){const i=Math.ceil(Date.now()/1e3);e._set||(e._set=i);const[s,o]=n(w,this)[t].expires,c=a(b,this,P).call(this,{value:s,units:o});e._exp=c+i,n(g,this)[t]=e,e=JSON.stringify(e),n(h,this).storeAsBase64&&(e="$:".concat(btoa(e)));const r=a(b,this,K).call(this,t);"cookie"===n(h,this).storageMethod?document.cookie="".concat(r,"=").concat(e,"; max-age=").concat(c,"; path=/; domain=").concat(n(h,this).cookieDomain,"; secure"):localStorage.setItem(r,e)}function Z(){let t=n(h,this).namespace.toLowerCase().trim();if("lvl"==t)return;[/[a-z]{2,4}/.test(t),"utm"!==t].includes(!1)&&(console.warn('Invalid namespace: Defaulting to "lvl".'),n(h,this).namespace="lvl")}function K(t){return"_".concat(n(h,this).storageNamespace,"_").concat(t)}return e=e.default})()));