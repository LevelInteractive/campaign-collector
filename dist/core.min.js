!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CampaignCollector=t():e.CampaignCollector=t()}(this,(()=>(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>s});class s{#e="CampaignCollector";#t="1.0.0";#s;#i=null;#o={consent:{ad_personalization:null,ad_storage:null,ad_user_data:null,analytics_storage:null},debug:!1,decorateHostnames:[],enableSpaSupport:!1,fieldMap:{anonymous_id:"$ns_anonymous_id",attribution:"$ns_attribution_json",consent:"$ns_consent_json",first:{utm:null,$ns:null},last:{utm:null,$ns:null},cookies:{},globals:{}},fieldTargetMethod:["name"],fieldDataAttribute:"data-campaign-collector",filters:{},firstPartyLeadEndpoint:null,firstPartyCookieEndpoint:null,namespace:"lvl",parseRules:{organic:{google:"^www.(google).[a-z]{2,3}(?:.[a-z]{2})?$",bing:"^www.(bing).com$",duckduckgo:"^(duckduckgo).com$",yahoo:"^(?:www|m)?.?(yahoo).(?:com|cn)$",ecosia:"^www.(ecosia).org$",ask:"^www.(ask).com$",aol:"^(?:search.)?(aol).com$",baidu:"^www.(baidu).com$",xfinity:"^my|search.(xfinity).com",yandex:"^(?:www.)?(yandex).com|ru$",lycos:"^(?:www|search)?.?(lycos).[a-z]{2,3}(?:.[a-z]{2})?$"},social:{facebook:"^www.(facebook).com$",instagram:"(instagram).com$",linkedin:"^www.(linkedin).com$",tiktok:"^www.(tiktok).com$",snapchat:"^www.(snapchat).com$",x:"^t.co|x.com$",pinterest:"^www.(pinterest).com$",reddit:"^www.(reddit).com$",quora:"^www.(quora).com$"}},sdk:null,sessionTimeout:null,storageDomain:null,storageMethod:"cookie",storageNamespace:"cc",storeAsBase64:!0,stripUtmsFromInternalLinks:!1,userDataHash:{city:!1,region:!1,postal_code:!1,country:!1}};#n=null;#a={utm:["source","medium","campaign","term","content","id","source_platform","marketing_tactic","creative_format","group","ad","product","feed","creative","extension","geo_int","geo_phy","target","network","device","matchtype","placement"],$ns:["platform","source","campaign_name","campaign","group","ad","product","feed","creative","extension","geo_int","geo_phy","target","network","device","matchtype","placement"]};#r={utm:["source","medium","campaign"],$ns:["platform","campaign","group","ad"]};#c=null;#l=null;#h={first:{expires:[400,"days"]},last:{expires:[30,"minutes"]}};#u;constructor(e={}){s.canRun()&&(console.time(this.#e),this.#u=new URL(window.location.href),this.#i=this.#d(this.#o,e),this.#m(),this.#f(),this.#p(),this.#g(),this.#y(),this.#b(),this.#w(["utm",this.#i.namespace]),Array.isArray(this.#i.sessionTimeout)&&(this.#h.last.expires=this.#i.sessionTimeout),this.#l=this.#_(),this.#$(),this.fill(),this.#k(),window.dataLayer&&window.dataLayer.push({event:`${this.#S(this.#e)}:ready`,campaign:this.grab({applyFilters:!0,without:["globals"]})}),this.#i.debug&&console.log(this.#i),console.timeEnd(this.#e))}static canRun(){return"undefined"!=typeof WeakMap&&"undefined"!=typeof URL&&"undefined"!=typeof localStorage}static create(e={},t=null){if(!s.canRun())return;const i=new s(e);return window._campaignCollector=window._campaignCollector||{},t&&!window._campaignCollector.hasOwnProperty(t)&&(window._campaignCollector[t]=i),["fill","grab","lead","debug"].reduce(((e,t)=>(e[t]=i[t].bind(i),e)),{})}static consentChange(e,t){if(!["ad_storage","ad_user_data","analytics_storage","ad_personalization"].includes(e))throw new Error("Invalid consent key.");if(!["granted","denied",null].includes(t))throw new Error('Invalid consent value. Must be "granted", "denied", or null.');const s="campaign-collector";document.dispatchEvent(new CustomEvent(`${s}:consent.change`,{detail:{type:e,status:t},bubbles:!0})),document.dispatchEvent(new Event(`${s}:${e}.${t}`,{bubbles:!0}))}get activeSession(){const e=this.#l.last;if(!e)return null;const t=Math.ceil(Date.now()/1e3);if(e._exp<t)return null;if(e._ref){const t=this.#v(e._ref);return t?{...e,[this.#i.namespace]:t[this.#i.namespace],utm:t.utm}:e}return e}get allowedFields(){return this.#a}get anonymousId(){return this.#E("analytics_storage")?this.#s:"(redacted)"}debug(){console.log(this.#i)}fill(e={}){e.hasOwnProperty("targetMethod")&&(e.targetMethod=Array.isArray(e.targetMethod)?e.targetMethod:[e.targetMethod]);const t={targetMethod:e.targetMethod||this.#i.fieldTargetMethod,scope:e.scope||document},s=this.#O(this.#i.fieldMap),i=this.grab({without:["params"],dereference:!0});["first","last"].forEach((e=>{s[e]&&(s[e]=this.#j(s[e])),i[e]&&(i[e]=this.#j(i[e]))}));for(const[e,o]of Object.entries(s))if("string"!=typeof o)for(const[s,n]of Object.entries(o)){const o=t.scope.querySelectorAll(this.#A(t.targetMethod,n));if(!o?.length)continue;let a=["cookies","globals"].includes(e)?"":"-",r=i[e][s]??a;["cookies","globals"].includes(e)&&r&&(r=this.#M(this.#i.filters[s],r)),Array.from(o).forEach((e=>{e.value||(e.value=r,e.setAttribute("value",r),e.dispatchEvent(new Event("input",{bubbles:!0})))}))}else{let s=o.replace("$ns",this.#i.storageNamespace);const i=t.scope.querySelectorAll(this.#A(t.targetMethod,s));if(i){const t={anonymous_id:this.anonymousId,consent:JSON.stringify(this.#i.consent),attribution:this.grab({asJson:!0,dereference:!0,without:["params"]})};Array.from(i).forEach((s=>{s.value=t[e],s.setAttribute("value",t[e]),s.dispatchEvent(new Event("input",{bubbles:!0}))}))}}}grab({applyFilters:e=!1,asJson:t=!1,dereference:s=!1,without:i=[]}={}){const o={namespace:this.#i.namespace};return i.includes("anonymous_id")||(o.anonymous_id=this.anonymousId),i.includes("params")||(o.params=this.#n),i.includes("first")||(o.first=this.#l.first),i.includes("last")||(o.last=this.#l.last,s&&this.#l.last._ref&&(o.last=Object.assign(this.#l[this.#l.last._ref],o.last))),i.includes("globals")||(o.globals=this.#x({applyFilters:e})),i.includes("cookies")||(o.cookies=this.#E("ad_user_data")?this.#C({applyFilters:e}):{}),t?JSON.stringify(o):o}async#L(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map((e=>e.toString(16).padStart(2,"0"))).join("")}lead(e={},t={}){if(!this.#i.firstPartyLeadEndpoint)throw new Error("`firstPartyLeadEndpoint` is required to send lead payload.");let s={anonymous_id:this.anonymousId,sent_at:(new Date).getTime(),event:"lead",consent:this.#i.consent,context:{attribution:this.grab({without:["anonymous_id","params","globals"]}),locale:navigator.language,page:{title:document.title,url:location.href,referrer:document.referrer},screen:{width:screen.width,height:screen.height,inner_width:innerWidth,inner_height:innerHeight},sdk:`${this.#e}@${this.#t}`,user_agent:navigator.userAgent}};this.#i.sdk&&(s.context.sdk+=`/${this.#i.sdk}`),Object.keys(e).forEach((t=>{/^[a-z_]+$/.test(t)||(console.warn(`${this.#e}.js: Removing "${t}" from lead payload. Keys must be in snake_case format.`),delete e[t])})),Object.keys(e).length>0&&(s.properties=e),["first_name","last_name","email","phone","city","region","postal_code","country","date_of_birth","gender"].forEach((e=>{t[e]&&(s.hasOwnProperty("user")||(s.user={}),s.user[e]=t[e].trim().toLowerCase(),delete t[e])})),this.#P(`https://${this.#i.firstPartyLeadEndpoint}`,s)}async#P(e,t){if(t.user){const e=[...Object.keys(this.#i.userDataHash).filter((e=>this.#i.userDataHash[e])),"first_name","last_name","email","phone","date_of_birth","gender"],s={},i={first_name:e=>e.replace(/[^a-z]/g,""),last_name:e=>e.replace(/[^a-z]/g,""),email:e=>{let[t,i]=e.split("@");s.email_domain=i;let o=[e];return["gmail.com","googlemail.com"].includes(i)&&(t=t.replace(/\./g,""),t=t.split("+")[0],o.push(t+"@"+i)),o},phone:e=>{if((e=e.replace(/[^0-9]/g,"")).length<10||e.length>11)return null;if("1"!==e[0]&&11===e.length)return null;const t=[e=10===e.length?`1${e}`:`${e}`,`+${e}`];return s.phone_area_code=e.substring(1,4),t},city:e=>e.replace(/[^a-z]/g,""),postal_code:e=>e.replace(/[^0-9]/g,"").substring(0,5),date_of_birth:e=>{const t=new Date(e);return s.age=`${Math.floor((new Date-t)/315576e5)}`,t.toISOString().split("T")[0].replace("-","")},gender:e=>e.substring(0,1)},o=(await Promise.all(Object.entries(t.user).map((async([t,s])=>{if(!s)return null;let o=i[t]?i[t](s):s;if(!o)return null;if(Array.isArray(o)){const s=await Promise.all(o.map((async s=>e.includes(t)?await this.#L(s):s)));return s.some((e=>e))?[t,s]:null}{const s=e.includes(t)?await this.#L(o):o;return s?[t,s]:null}})))).filter((e=>null!==e));o.length>0?t.user=Object.assign(Object.fromEntries(o),s):t.user={}}this.#i.debug&&console.log("Sending payload:",t),fetch(e,{method:"POST",body:btoa(JSON.stringify(t)),keepalive:!0})}#M(e,t){if("function"!=typeof e)return t;try{t=e(t)}catch(e){console.error(`${this.#e}.js: Error applying filter.`,e.message)}return t}#k(){if(this.#i.enableSpaSupport){this.#I();const e=e=>{this.#y(!0),this.#$()};window.addEventListener("popstate",e),window.onpopstate=history.onpushstate=e}document.addEventListener("click",(e=>{const t=e.target.closest("a[href]");if(!t)return;const s=new URL(t.href);if(s.hostname.includes(this.#i.storageDomain)){if(this.#i.stripUtmsFromInternalLinks){if(!s.search.includes("utm_"))return;this.#a.utm.forEach((e=>{s.searchParams.delete(`utm_${e}`)}))}}else{if(!this.#i.decorateHostnames.some((e=>s.hostname.includes(e)||s.hostname===e)))return;const e=this.#j(this.activeSession);for(const[t,i]of Object.entries(e))t.startsWith("_")||s.searchParams.set(t,i)}t.href=s.href}),!0);const e=((e,t)=>{let s,i=!0;return function(...o){if(i)return i=!1,void e(...o);clearTimeout(s),s=setTimeout((()=>{clearTimeout(s),e(...o)}),t)}})((e=>{const t=e.target.closest("form");t&&this.fill(t)}),1500);["mousedown","touchstart"].forEach((t=>{document.addEventListener(t,(t=>{e(t),this.#N()}))}));const t=this.#S(this.#e);document.addEventListener(`${t}:consent.change`,(e=>{const{type:t,status:s}=e.detail;this.#D(t,s)}))}#F(e){const t=this.#n[e];if(!Object.keys(t).length)return;const s=this.#r[e];for(const e of s)if(!t.hasOwnProperty(e))return!1;return!0}#C({applyFilters:e=!1}={}){let t={};if(!this.#i.fieldMap.cookies)return t;for(const[s,i]of Object.entries(this.#i.fieldMap.cookies)){let i=this.#R(s);i&&(e&&(i=this.#M(this.#i.filters[s],i)),t[s]=i)}return t}#x({applyFilters:e=!1}={}){let t={};for(const[s,i]of Object.entries(this.#i.fieldMap.globals))try{let i=this.#z(s);if(!i)continue;e&&(i=this.#M(this.#i.filters[s],i)),t[s]=i}catch(e){console.error(`${this.#e}.js: Error resolving global "${s}"`,e.message)}return t}#E(e){return{granted:!0,denied:!1,null:!0,null:!0}[this.#i.consent[e]]}#D(e,t){this.#i.consent[e]=t?t.toLowerCase():null}#O(e){return JSON.parse(JSON.stringify(e))}#d(e,t){for(const s in t)t.hasOwnProperty(s)&&(Array.isArray(t[s])?e[s]=t[s].slice():"object"==typeof t[s]&&null!==t[s]?(e[s]||(e[s]={}),this.#d(e[s],t[s])):e[s]=t[s]);return e}#j(e,t=""){return Object.keys(e).reduce(((s,i)=>{const o=t.length?`${t}_`:"";return"object"!=typeof e[i]||null===e[i]||Array.isArray(e[i])?s[`${o}${i}`]=e[i]:Object.assign(s,this.#j(e[i],`${o}${i}`)),s}),{})}#A(e=[],t){return e.map((e=>{const s={class:"input."+t,parentClass:"."+t+" input",dataAttribute:"input["+this.#i.fieldDataAttribute+'="'+t+'"]',name:'input[name="'+t+'"]'};return s[e]||s.name})).join(",")}#R(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2].trim():null}#T({value:e=0,units:t="minutes"}={}){const s={minutes:60,hours:3600,days:86400,weeks:604800,months:2592e3,years:31536e3}[t.toLowerCase()];return s?parseInt(e)*s:0}#$(){const e=this.#l.last;e&&e._exp<Math.ceil(Date.now()/1e3)&&this.#U("last");const t=this.#i.namespace;let s={utm:{source:"(direct)",medium:"(none)"}};s[t]={};const i=this.#F("utm"),o=this.#F(t);if(i||o)i&&Object.assign(s.utm,this.#n.utm),o&&Object.assign(s[t],this.#n[t]);else{const e=this.activeSession,i=(e,t)=>!(!e||!this.#r[t])&&this.#r[t].every((s=>e[t]?.[s]&&(!["utm"].includes(t)||"source"===s&&"(direct)"!==e[t][s]||"medium"===s&&"(none)"!==e[t][s]))),o=i(e,"utm"),n=i(e,t);o||n?s=e:Object.assign(s.utm,this.#G())}this.#l?.first?s=this.#l.last&&"(direct)"===s.utm.source?this.#l.last:s:(this.#l.first=s,this.#H("first",s),s={_ref:"first"}),this.#l.last=s,this.#H("last",s)}#I(){console.warn(`${this.#e}.js: config.enableSpaSupport = true monkeypatches the the history.pushState() method.`);let e=history.pushState;history.pushState=function(t){return"function"==typeof history.onpushstate&&history.onpushstate({state:t}),e.apply(history,arguments)}}#G(){let e={};if(!this.#c||this.#c.hostname.indexOf(this.#i.storageDomain)>-1)return e;e={source:this.#c.hostname,medium:"referral"};for(const[t,s]of Object.entries(this.#i.parseRules)){for(const[i,o]of Object.entries(s))if(this.#c.hostname.match(o)){e.source=i,e.medium=`${t}`;break}if(Object.keys(s).indexOf(e.medium)>-1)break}return e}#p(){if(this.#i.storageDomain)return;const e=this.#u.hostname;if("localhost"===e)return"";const t=e.split(".");this.#i.storageDomain=t.length<=2?e:t.slice(-2).join(".")}#z(e){return e.split(".").reduce(((e,t)=>e?e[t]:null),window)}#J(e){if(!e)return"";let t=String(e).trim();t=t.slice(0,255),t=t.replace(/[^a-zA-Z0-9_\-%.@+~$!:=;/|\[\]\(\) ]/g,"");return[/--|;/g,/\/\*|\*\//g].forEach((e=>{t=t.replace(e,"")})),t}#_(){let e={};const t=Math.ceil(Date.now()/1e3);for(const[s,i]of Object.entries(this.#h))e[s]=this.#v(s),"cookie"!==this.#i.storageMethod&&e[s]?._exp<t&&(this.#U(s),e[s]=null);return e}#g(){const e=`_${this.#i.storageNamespace}_anonymous_id`;this.#s=this.#R(e),this.#s||(this.#s=`CC.1.${Date.now()}.${Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}`),"cookie"===this.#i.storageMethod?document.cookie=`${e}=${this.#s}; max-age=${this.#T({value:400,units:"days"})}; path=/; domain=${this.#i.storageDomain}; secure`:localStorage.setItem(e,this.#s)}#f(){const e=this.#i.fieldMap;for(const[t,s]of Object.entries(e))if(["first","last"].includes(t))for(const[e,i]of Object.entries(s)){let s={};this.#a[e].forEach((i=>{let o="$ns"===e?this.#i.namespace:e;s[i]=`${o}_${i}`,"first"==t&&(s[i]+="_1st")}));let o=this.#d(s,i);"$ns"===e?(this.#i.fieldMap[t][this.#i.namespace]=o,delete this.#i.fieldMap[t][e]):this.#i.fieldMap[t][e]=o}}#b(){let e=this.#a.$ns,t=this.#r.$ns;this.#a[this.#i.namespace]=e,this.#r[this.#i.namespace]=t,delete this.#a.$ns,delete this.#r.$ns}#w(e=[]){const t=this.#u.searchParams;let s={};e=e.length>0?e:[this.#i.namespace];for(const t of e)s[t]={};const i="stray";if(s[i]={},t){for(const[o,n]of t.entries()){let t=!1;for(const i of e)if(o.startsWith(i+"_")){const e=o.slice(i.length+1);this.#a[i].includes(e)&&(s[i][e]=this.#J(n),t=!0);break}t||(s[i][o]=this.#J(n))}this.#n=s}else this.#n=s}#y(e=!1){let t;t=e?null:document.referrer?new URL(document.referrer):null,this.#c=t}#U(e){const t=this.#K(e);this.#l[e]=null,"cookie"===this.#i.storageMethod?document.cookie=`${t}=; max-age=0; path=/; domain=${this.#i.storageDomain}`:localStorage.removeItem(t)}#v(e){const t=this.#K(e);let s="cookie"===this.#i.storageMethod?this.#R(t):localStorage.getItem(t);return s?(s.startsWith("$:")&&(s=atob(s.split(":")[1])),s=JSON.parse(s),"null"===s&&(s=null),s):null}#N(){let e=this.#v("last");e&&this.#H("last",e)}#H(e,t){const s=Math.ceil(Date.now()/1e3);t._set||(t._set=s);const[i,o]=this.#h[e].expires,n=this.#T({value:i,units:o});t._exp=n+s,this.#l[e]=t,t=JSON.stringify(t),this.#i.storeAsBase64&&(t=`$:${btoa(t)}`);const a=this.#K(e);"cookie"===this.#i.storageMethod?document.cookie=`${a}=${t}; max-age=${n}; path=/; domain=${this.#i.storageDomain}; secure`:localStorage.setItem(a,t)}#m(){let e=this.#i.namespace.toLowerCase().trim();if("lvl"==e)return;[/[a-z]{2,4}/.test(e),"utm"!==e].includes(!1)&&(console.warn('Invalid namespace: Defaulting to "lvl".'),this.#i.namespace="lvl")}#K(e){return`_${this.#i.storageNamespace}_${e}`}#S(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}return t=t.default})()));