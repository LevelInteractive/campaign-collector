!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CampaignCollector=e():t.CampaignCollector=e()}(this,(()=>(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function s(t,e,s){i(t,e),e.set(t,s)}function i(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function o(t,e,s){return t.set(a(t,e),s),s}function n(t,e){return t.get(a(t,e))}function a(t,e,s){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:s;throw new TypeError("Private element is not present on this object")}t.d(e,{default:()=>w});var l=new WeakMap,c=new WeakMap,r=new WeakMap,h=new WeakMap,u=new WeakMap,f=new WeakMap,p=new WeakMap,d=new WeakMap,m=new WeakMap,g=new WeakSet;class w{static create(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=new w(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return t&&!window.hasOwnProperty(t)&&(window[t]=e),["fill","grab"].reduce(((t,s)=>(t[s]=e[s].bind(e),t)),{})}constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e,w;i(e=this,w=g),w.add(e),s(this,l,"CampaignCollector"),s(this,c,null),s(this,r,{cookieDomain:null,decorateHostnames:[],enableSpaSupport:!1,fieldMap:{$json:"campaign_json",last:{utm:null,$ns:null},first:{utm:null,$ns:null},cookies:{},globals:{}},fieldTargetMethod:["name"],fieldDataAttribute:"data-campaign-collector",filters:{},namespace:"lvl",parseRules:{organic:{google:"^www.(google).[a-z]{2,3}(?:.[a-z]{2})?$",bing:"^www.(bing).com$",duckduckgo:"^(duckduckgo).com$",yahoo:"^(?:www|m)?.?(yahoo).(?:com|cn)$",ecosia:"^www.(ecosia).org$",ask:"^www.(ask).com$",aol:"^(?:search.)?(aol).com$",baidu:"^www.(baidu).com$",xfinity:"^my|search.(xfinity).com",yandex:"^(?:www.)?(yandex).com|ru$",lycos:"^(?:www|search)?.?(lycos).[a-z]{2,3}(?:.[a-z]{2})?$"},social:{facebook:"^www.(facebook).com$",instagram:"^l.(instagram).com$",linkedin:"^www.(linkedin).com$",x:"^t.co|x.com$"}},reportAnomalies:!1,sessionTimeout:null,storageMethod:"cookie",storeAsBase64:!0}),s(this,h,null),s(this,u,{utm:["source","medium","campaign","term","content","id","source_platform","marketing_tactic","creative_format"],$ns:["platform","source","campaign","group","ad","product","feed","creative","extension","geo_int","geo_phy","target","network","device","matchtype","placement"]}),s(this,f,{utm:["source","medium","campaign"],$ns:["platform","campaign","group","ad"]}),s(this,p,null),s(this,d,null),s(this,m,{first:{expires:[2,"years"]},last:{expires:[30,"minutes"]}}),console.time(n(l,this)),this.url=new URL(window.location.href),o(c,this,a(g,this,$).call(this,n(r,this),t)),a(g,this,P).call(this),a(g,this,W).call(this),a(g,this,z).call(this),a(g,this,T).call(this),a(g,this,F).call(this,["utm",n(c,this).namespace]),Array.isArray(n(c,this).sessionTimeout)&&(n(m,this).last.expires=n(c,this).sessionTimeout),o(d,this,a(g,this,L).call(this)),a(g,this,A).call(this),console.log(n(c,this)),this.fill(),a(g,this,y).call(this),window.dataLayer&&window.dataLayer.push({event:"lvl.campaign-collector:ready",campaign:this.grab({applyFilters:!0,without:["globals"]})}),console.timeEnd(n(l,this))}get activeSession(){const t=n(d,this).last;if(!t)return null;const e=Math.ceil(Date.now()/1e3);return t.$exp<e&&(n(d,this).last=null,a(g,this,A).call(this)),n(d,this).last}get allowedFields(){return n(u,this)}fill(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.hasOwnProperty("targetMethod")&&(t.targetMethod=Array.isArray(t.targetMethod)?t.targetMethod:[t.targetMethod]);const e={targetMethod:t.targetMethod||n(c,this).fieldTargetMethod,scope:t.scope||document},s=a(g,this,M).call(this,n(c,this).fieldMap),i=this.grab({without:["params"]});["first","last"].forEach((t=>{s[t]&&(s[t]=a(g,this,j).call(this,s[t])),i[t]&&(i[t]=a(g,this,j).call(this,i[t]))})),console.log(s);for(const[t,n]of Object.entries(s))if("$json"!==t)for(const[s,l]of Object.entries(n)){var o;const n=e.scope.querySelectorAll(a(g,this,O).call(this,e.targetMethod,l));if(null==n||!n.length)continue;const c=null!==(o=i[t][s])&&void 0!==o?o:"-";Array.from(n).forEach((t=>{t.value=c,t.setAttribute("value",c),t.dispatchEvent(new Event("input",{bubbles:!0}))}))}}grab(){let{applyFilters:t=!1,without:e=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s={};return e.includes("params")||(s.params=n(h,this)),e.includes("first")||(s.first=n(d,this).first),e.includes("last")||(s.last=n(d,this).last),e.includes("globals")||(s.globals=a(g,this,v).call(this,{applyFilters:t})),e.includes("cookies")||(s.cookies=a(g,this,k).call(this,{applyFilters:t})),s}}function y(){const t=t=>{if(!t.target.matches('[type="submit"]'))return;const e=t.target.closest("form");let s;this.fill(e),e.querySelectorAll(a(g,this,O).call(this,n(c,this).fieldTargetMethod,n(c,this).fieldMap.$json)).forEach((t=>{var e;s=null!==(e=s)&&void 0!==e?e:JSON.stringify(this.grab({without:["params"]})),t.value=s}))};if(n(c,this).enableSpaSupport){a(g,this,E).call(this);const t=t=>{a(g,this,z).call(this,!0),a(g,this,A).call(this)};window.addEventListener("popstate",t),window.onpopstate=history.onpushstate=t}document.addEventListener("mousedown",(e=>{t(e),a(g,this,R).call(this)})),document.addEventListener("touchstart",t)}function b(t){const e=n(h,this)[t];if(!Object.keys(e).length)return;const s=n(f,this)[t];for(const t of s)if(!e.hasOwnProperty(t))return!1;return!0}function k(){let{applyFilters:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};if(!n(c,this).fieldMap.cookies)return e;for(const[s,i]of Object.entries(n(c,this).fieldMap.cookies)){let i=a(g,this,x).call(this,s);if(i){if(t&&"function"==typeof n(c,this).filters[s])try{i=n(c,this).filters[s](i)}catch(t){console.error("".concat(n(l,this),'.js: Error applying filter to cookie "').concat(s,'"'),t.message)}e[s]=i}}return e}function v(){let{applyFilters:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};for(const[s,i]of Object.entries(n(c,this).fieldMap.globals))try{let i=a(g,this,D).call(this,s);if(!i)continue;t&&"function"==typeof n(c,this).filters[s]&&(i=n(c,this).filters[s](i)),e[s]=i}catch(t){console.error("".concat(n(l,this),'.js: Error resolving global "').concat(s,'"'),t.message)}return e}function M(t){return JSON.parse(JSON.stringify(t))}function $(t,e){for(const s in e)e.hasOwnProperty(s)&&(Array.isArray(e[s])?t[s]=e[s].slice():"object"==typeof e[s]&&null!==e[s]?(t[s]||(t[s]={}),a(g,this,$).call(this,t[s],e[s])):t[s]=e[s]);return t}function j(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object.keys(t).reduce(((s,i)=>{const o=e.length?"".concat(e,"_"):"";return"object"!=typeof t[i]||null===t[i]||Array.isArray(t[i])?s["".concat(o).concat(i)]=t[i]:Object.assign(s,a(g,this,j).call(this,t[i],"".concat(o).concat(i))),s}),{})}function O(){let t=arguments.length>1?arguments[1]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>{const s={class:"input."+t,parentClass:"."+t+" input",dataAttribute:"input["+n(c,this).fieldDataAttribute+'="'+t+'"]',name:'input[name="'+t+'"]'};return s[e]||s.name})).join(",")}function x(t){const e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]+)"));return e?e[2].trim():null}function S(){let{value:t=0,units:e="minutes"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s={minutes:60,hours:3600,days:86400,weeks:604800,months:2592e3,years:31536e3}[e.toLowerCase()];return s?parseInt(t)*s:0}function A(){var t;const e=n(c,this).namespace;let s={utm:{source:"(direct)",medium:"(none)"}};s[e]={};const i=a(g,this,b).call(this,"utm"),o=a(g,this,b).call(this,e);i&&Object.assign(s.utm,n(h,this).utm),o&&Object.assign(s[e],n(h,this)[e]),i||o||Object.assign(s.utm,a(g,this,_).call(this)),null!==(t=n(d,this))&&void 0!==t&&t.first?(console.log("first touchpoint exists"),s=n(d,this).last&&"(direct)"===s.utm.source?n(d,this).last:s):(n(d,this).first=s,a(g,this,I).call(this,"first",s),s={$ref:"first"}),n(d,this).last=s,a(g,this,I).call(this,"last",s)}function E(){console.warn("".concat(n(l,this),".js: config.enableSpaSupport = true monkeypatches the the history.pushState() method."));let t=history.pushState;history.pushState=function(e){return"function"==typeof history.onpushstate&&history.onpushstate({state:e}),t.apply(history,arguments)}}function _(){let t={};if(!n(p,this)||n(p,this).hostname.indexOf(n(c,this).cookieDomain)>-1)return t;t={source:n(p,this).hostname,medium:"(referral)"};for(const[e,s]of Object.entries(n(c,this).parseRules)){for(const[i,o]of Object.entries(s))if(n(p,this).hostname.match(o)){t.source=i,t.medium="(".concat(e,")");break}if(Object.keys(s).indexOf(t.medium)>-1)break}return t}function W(){if(n(c,this).cookieDomain)return;const t=this.url.hostname;if("localhost"===t)return"";const e=t.split(".").reverse();let s=[e[1],e[0]].join(".");e.length>2&&e[1].length<=3&&(s=[e[2],s].join(".")),n(c,this).cookieDomain=s}function D(t){return t.split(".").reduce(((t,e)=>t?t[e]:null),window)}function C(t){if(!t)return"";let e=String(t).trim();e=e.slice(0,255),e=e.replace(/[^a-zA-Z0-9_\-%.@+~$!:=;/|\[\]\(\) ]/g,"");return[/--|;/g,/\/\*|\*\//g].forEach((t=>{e=e.replace(t,"")})),e}function L(){let t={};const e=Math.ceil(Date.now()/1e3);for(const[i,o]of Object.entries(n(m,this))){var s;t[i]=a(g,this,N).call(this,i),"cookie"!==n(c,this).storageMethod&&(null===(s=t[i])||void 0===s?void 0:s.$exp)<e&&(a(g,this,J).call(this,i),t[i]=null)}return t}function P(){const t=n(c,this).fieldMap;for(const[e,s]of Object.entries(t))if(["first","last"].includes(e))for(const[t,i]of Object.entries(s)){let s={};n(u,this)[t].forEach((i=>{let o="$ns"===t?n(c,this).namespace:t;s[i]="".concat(o,"_").concat(i),"first"==e&&(s[i]+="_1st")}));let o=a(g,this,$).call(this,s,i);"$ns"===t?(n(c,this).fieldMap[e][n(c,this).namespace]=o,delete n(c,this).fieldMap[e][t]):n(c,this).fieldMap[e][t]=o}}function T(){let t=n(u,this).$ns,e=n(f,this).$ns;n(u,this)[n(c,this).namespace]=t,n(f,this)[n(c,this).namespace]=e,delete n(u,this).$ns,delete n(f,this).$ns}function F(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=this.url.searchParams;let s={};t=t.length>0?t:[n(c,this).namespace];for(const e of t)s[e]={};const i="stray";if(s[i]={},e){for(const[o,l]of e.entries()){let e=!1;for(const i of t)if(o.startsWith(i+"_")){const t=o.slice(i.length+1);n(u,this)[i].includes(t)&&(s[i][t]=a(g,this,C).call(this,l),e=!0);break}e||(s[i][o]=a(g,this,C).call(this,l))}o(h,this,s)}else o(h,this,s)}function z(){let t;t=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?null:document.referrer?new URL(document.referrer):null,o(p,this,t)}function J(t){const e=a(g,this,q).call(this,t);"cookie"===n(c,this).storageMethod?document.cookie="".concat(e,"=; max-age=0; path=/; domain=").concat(n(c,this).cookieDomain):localStorage.removeItem(e)}function N(t){const e=a(g,this,q).call(this,t);let s="cookie"===n(c,this).storageMethod?a(g,this,x).call(this,e):localStorage.getItem(e);return s?(s.startsWith("64:")&&(s=atob(s.split(":")[1])),s.$ref?a(g,this,N).call(this,s.$ref):(s=JSON.parse(s),"null"===s&&(s=null),s)):null}function R(){let t=a(g,this,N).call(this,"last");t&&a(g,this,I).call(this,"last",t)}function I(t,e){const s=Math.ceil(Date.now()/1e3);e.$set||(e.$set=s);const[i,o]=n(m,this)[t].expires,l=a(g,this,S).call(this,{value:i,units:o});e.$exp=l+s,e=JSON.stringify(e),n(c,this).storeAsBase64&&(e="64:".concat(btoa(e)));const r=a(g,this,q).call(this,t);"cookie"===n(c,this).storageMethod?document.cookie="".concat(r,"=").concat(e,"; max-age=").concat(l,"; path=/; domain=").concat(n(c,this).cookieDomain,"; secure"):localStorage.setItem(r,e)}function q(t){return"_lvl_cc_".concat(t)}return e=e.default})()));