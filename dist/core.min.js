!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.CampaignCollector=e():t.CampaignCollector=e()}(this,(()=>(()=>{"use strict";var t={d:(e,s)=>{for(var n in s)t.o(s,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:s[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};function s(t,e,s){n(t,e),e.set(t,s)}function n(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function i(t,e,s){return t.set(o(t,e),s),s}function a(t,e){return t.get(o(t,e))}function o(t,e,s){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:s;throw new TypeError("Private element is not present on this object")}t.d(e,{default:()=>_});var r=new WeakMap,c=new WeakMap,l=new WeakMap,h=new WeakMap,u=new WeakMap,d=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,w=new WeakMap,y=new WeakMap,b=new WeakSet;class _{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var e,_;n(e=this,_=b),_.add(e),s(this,r,"CampaignCollector"),s(this,c,"1.0.0"),s(this,l,void 0),s(this,h,null),s(this,u,{consent:{ad_personalization:null,ad_storage:null,ad_user_data:null,analytics_storage:null},debug:!1,decorateHostnames:[],enableSpaSupport:!1,fieldMap:{anonymous_id:"$ns_anonymous_id",attribution:"$ns_attribution_json",consent:"$ns_consent_json",first:{utm:null,$ns:null},last:{utm:null,$ns:null},cookies:{},globals:{}},fieldTargetMethod:["name"],fieldDataAttribute:"data-campaign-collector",filters:{},firstPartyLeadEndpoint:null,firstPartyCookieEndpoint:null,namespace:"lvl",parseRules:{organic:{google:"^www.(google).[a-z]{2,3}(?:.[a-z]{2})?$",bing:"^www.(bing).com$",duckduckgo:"^(duckduckgo).com$",yahoo:"^(?:www|m)?.?(yahoo).(?:com|cn)$",ecosia:"^www.(ecosia).org$",ask:"^www.(ask).com$",aol:"^(?:search.)?(aol).com$",baidu:"^www.(baidu).com$",xfinity:"^my|search.(xfinity).com",yandex:"^(?:www.)?(yandex).com|ru$",lycos:"^(?:www|search)?.?(lycos).[a-z]{2,3}(?:.[a-z]{2})?$"},social:{facebook:"^www.(facebook).com$",instagram:"(instagram).com$",linkedin:"^www.(linkedin).com$",tiktok:"^www.(tiktok).com$",snapchat:"^www.(snapchat).com$",x:"^t.co|x.com$",pinterest:"^www.(pinterest).com$",reddit:"^www.(reddit).com$",quora:"^www.(quora).com$"}},sdk:null,sessionTimeout:null,storageDomain:null,storageMethod:"cookie",storageNamespace:"cc",storeAsBase64:!0}),s(this,d,null),s(this,f,{utm:["source","medium","campaign","term","content","id","source_platform","marketing_tactic","creative_format"],$ns:["platform","source","campaign_name","campaign","group","ad","product","feed","creative","extension","geo_int","geo_phy","target","network","device","matchtype","placement"]}),s(this,p,{utm:["source","medium","campaign"],$ns:["platform","campaign","group","ad"]}),s(this,m,null),s(this,g,null),s(this,w,{first:{expires:[400,"days"]},last:{expires:[30,"minutes"]}}),s(this,y,void 0),console.time(a(r,this)),i(y,this,new URL(window.location.href)),i(h,this,o(b,this,C).call(this,a(u,this),t)),o(b,this,V).call(this),o(b,this,H).call(this),o(b,this,N).call(this),o(b,this,q).call(this),o(b,this,Z).call(this),o(b,this,U).call(this),o(b,this,B).call(this,["utm",a(h,this).namespace]),Array.isArray(a(h,this).sessionTimeout)&&(a(w,this).last.expires=a(h,this).sessionTimeout),i(g,this,o(b,this,R).call(this)),o(b,this,T).call(this),o(b,this,j).call(this),window.dataLayer&&window.dataLayer.push({event:"".concat(o(b,this,tt).call(this,a(r,this)),":ready"),campaign:this.grab({applyFilters:!0,without:["globals"]})}),a(h,this).debug&&console.log(a(h,this)),console.timeEnd(a(r,this))}static create(){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;const e=new _(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return window._campaignCollector=window._campaignCollector||{},t&&!window._campaignCollector.hasOwnProperty(t)&&(window._campaignCollector[t]=e),["fill","grab","lead","debug"].reduce(((t,s)=>(t[s]=e[s].bind(e),t)),{})}static consentChange(t,e){if(!["ad_storage","ad_user_data","analytics_storage","ad_personalization"].includes(t))throw new Error("Invalid consent key.");if(!["granted","denied",null].includes(e))throw new Error('Invalid consent value. Must be "granted", "denied", or null.');const s="campaign-collector";document.dispatchEvent(new CustomEvent("".concat(s,":consent.change"),{detail:{type:t,status:e},bubbles:!0})),document.dispatchEvent(new Event("".concat(s,":").concat(t,".").concat(e),{bubbles:!0}))}get activeSession(){const t=a(g,this).last;if(!t)return null;const e=Math.ceil(Date.now()/1e3);if(t._exp<e&&(o(b,this,G).call(this,"last"),o(b,this,T).call(this)),t._ref){const e=o(b,this,K).call(this,t._ref);if(!e)return t;t[a(h,this).namespace]=e[a(h,this).namespace],t.utm=e.utm}return t}get allowedFields(){return a(f,this)}get anonymousId(){return o(b,this,S).call(this,"analytics_storage")?a(l,this):"(redacted)"}debug(){console.log(a(h,this))}fill(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.hasOwnProperty("targetMethod")&&(t.targetMethod=Array.isArray(t.targetMethod)?t.targetMethod:[t.targetMethod]);const e={targetMethod:t.targetMethod||a(h,this).fieldTargetMethod,scope:t.scope||document},s=o(b,this,x).call(this,a(h,this).fieldMap),n=this.grab({without:["params"],dereference:!0});["first","last"].forEach((t=>{s[t]&&(s[t]=o(b,this,D).call(this,s[t])),n[t]&&(n[t]=o(b,this,D).call(this,n[t]))}));for(const[t,r]of Object.entries(s))if("string"!=typeof r)for(const[s,c]of Object.entries(r)){var i;const r=e.scope.querySelectorAll(o(b,this,P).call(this,e.targetMethod,c));if(null==r||!r.length)continue;let l=null!==(i=n[t][s])&&void 0!==i?i:"-";["cookies","globals"].includes(t)&&(l=o(b,this,M).call(this,a(h,this).filters[s],l)),Array.from(r).forEach((t=>{t.value=l,t.setAttribute("value",l),t.dispatchEvent(new Event("input",{bubbles:!0}))}))}else{let s=r.replace("$ns",a(h,this).storageNamespace);const n=e.scope.querySelectorAll(o(b,this,P).call(this,e.targetMethod,s));if(n){const e={anonymous_id:this.anonymousId,consent:JSON.stringify(a(h,this).consent),attribution:this.grab({asJson:!0,without:["params"]})};Array.from(n).forEach((s=>{s.value=e[t],s.setAttribute("value",e[t]),s.dispatchEvent(new Event("input",{bubbles:!0}))}))}}}grab(){let{applyFilters:t=!1,asJson:e=!1,dereference:s=!1,without:n=[]}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i={namespace:a(h,this).namespace};return n.includes("anonymous_id")||(i.anonymous_id=this.anonymousId),n.includes("params")||(i.params=a(d,this)),n.includes("first")||(i.first=a(g,this).first),n.includes("last")||(i.last=a(g,this).last,s&&a(g,this).last._ref&&(i.last=Object.assign(a(g,this)[a(g,this).last._ref],i.last))),n.includes("globals")||(i.globals=o(b,this,E).call(this,{applyFilters:t})),n.includes("cookies")||(i.cookies=o(b,this,S).call(this,"ad_user_data")?o(b,this,$).call(this,{applyFilters:t}):{}),e?JSON.stringify(i):i}lead(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!a(h,this).firstPartyLeadEndpoint)throw new Error("`firstPartyLeadEndpoint` is required to send lead payload.");let s={anonymous_id:this.anonymousId,sent_at:(new Date).getTime(),event:"lead",consent:a(h,this).consent,context:{attribution:this.grab({without:["anonymous_id","params","globals"]}),locale:navigator.language,page:{title:document.title,url:location.href,referrer:document.referrer},screen:{width:screen.width,height:screen.height,inner_width:innerWidth,inner_height:innerHeight},sdk:"".concat(a(r,this),"@").concat(a(c,this)),user_agent:navigator.userAgent}};a(h,this).sdk&&(s.context.sdk+="/".concat(a(h,this).sdk)),Object.keys(t).forEach((e=>{/^[a-z_]+$/.test(e)||(console.warn("".concat(a(r,this),'.js: Removing "').concat(e,'" from lead payload. Keys must be in snake_case format.')),delete t[e])})),Object.keys(t).length>0&&(s.properties=t),["first_name","last_name","email","phone","city","region","postal_code","country"].forEach((t=>{e[t]&&(s.hasOwnProperty("user")||(s.user={}),s.user[t]=e[t].trim().toLowerCase(),delete e[t])})),o(b,this,k).call(this,"https://".concat(a(h,this).firstPartyLeadEndpoint),s)}}async function v(t){const e=(new TextEncoder).encode(t),s=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(s)).map((t=>t.toString(16).padStart(2,"0"))).join("")}async function k(t,e){if(e.user){const t=["first_name","last_name","email","phone","date_of_birth","gender"],s={},n={first_name:t=>t.replace(/[^a-z]/g,""),last_name:t=>t.replace(/[^a-z]/g,""),email:t=>(s.email_domain=t.split("@")[1],t),phone:t=>{if((t=t.replace(/[^0-9]/g,"")).length<10||t.length>11)return null;if("1"!==t[0]&&11===t.length)return null;const e=[t=10===t.length?"1".concat(t):"".concat(t),"+".concat(t)];return s.phone_area_code=t.substring(1,4),e},city:t=>t.replace(/[^a-z]/g,""),postal_code:t=>t.replace(/[^0-9]/g,"").substring(0,5),date_of_birth:t=>{const s=new Date(t);return e.user.age="".concat(Math.floor((new Date-s)/315576e5)),s.toISOString().split("T")[0].replace("-","")},gender:t=>t.substring(0,1)},i=(await Promise.all(Object.entries(e.user).map((async e=>{let[s,i]=e;if(!i)return null;let a=n[s]?n[s](i):i;if(!a)return null;if(Array.isArray(a)){const e=await Promise.all(a.map((async e=>t.includes(s)?await o(b,this,v).call(this,e):e)));return e.some((t=>t))?[s,e]:null}{const e=t.includes(s)?await o(b,this,v).call(this,a):a;return e?[s,e]:null}})))).filter((t=>null!==t));i.length>0?e.user=Object.assign(Object.fromEntries(i),s):e.user={}}fetch(t,{method:"POST",body:btoa(JSON.stringify(e)),keepalive:!0})}function M(t,e){if("function"!=typeof t)return e;try{e=t(e)}catch(t){console.error("".concat(a(r,this),".js: Error applying filter."),t.message)}return e}function j(){if(a(h,this).enableSpaSupport){o(b,this,z).call(this);const t=t=>{o(b,this,Z).call(this,!0),o(b,this,T).call(this)};window.addEventListener("popstate",t),window.onpopstate=history.onpushstate=t}const t=((t,e)=>{let s,n=!0;return function(){for(var i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];if(n)return n=!1,void t(...a);clearTimeout(s),s=setTimeout((()=>{clearTimeout(s),t(...a)}),e)}})((t=>{const e=t.target.closest("form");e&&this.fill(e)}),1500);["mousedown","touchstart"].forEach((e=>{document.addEventListener(e,(e=>{t(e),o(b,this,X).call(this)}))}));const e=o(b,this,tt).call(this,a(r,this));document.addEventListener("".concat(e,":consent.change"),(t=>{const{type:e,status:s}=t.detail;o(b,this,A).call(this,e,s)}))}function O(t){const e=a(d,this)[t];if(!Object.keys(e).length)return;const s=a(p,this)[t];for(const t of s)if(!e.hasOwnProperty(t))return!1;return!0}function $(){let{applyFilters:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};if(!a(h,this).fieldMap.cookies)return e;for(const[s,n]of Object.entries(a(h,this).fieldMap.cookies)){let n=o(b,this,L).call(this,s);n&&(t&&(n=o(b,this,M).call(this,a(h,this).filters[s],n)),e[s]=n)}return e}function E(){let{applyFilters:t=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={};for(const[s,n]of Object.entries(a(h,this).fieldMap.globals))try{let n=o(b,this,J).call(this,s);if(!n)continue;t&&(n=o(b,this,M).call(this,a(h,this).filters[s],n)),e[s]=n}catch(t){console.error("".concat(a(r,this),'.js: Error resolving global "').concat(s,'"'),t.message)}return e}function S(t){return{granted:!0,denied:!1,null:!0,null:!0}[a(h,this).consent[t]]}function A(t,e){a(h,this).consent[t]=e?e.toLowerCase():null}function x(t){return JSON.parse(JSON.stringify(t))}function C(t,e){for(const s in e)e.hasOwnProperty(s)&&(Array.isArray(e[s])?t[s]=e[s].slice():"object"==typeof e[s]&&null!==e[s]?(t[s]||(t[s]={}),o(b,this,C).call(this,t[s],e[s])):t[s]=e[s]);return t}function D(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return Object.keys(t).reduce(((s,n)=>{const i=e.length?"".concat(e,"_"):"";return"object"!=typeof t[n]||null===t[n]||Array.isArray(t[n])?s["".concat(i).concat(n)]=t[n]:Object.assign(s,o(b,this,D).call(this,t[n],"".concat(i).concat(n))),s}),{})}function P(){let t=arguments.length>1?arguments[1]:void 0;return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]).map((e=>{const s={class:"input."+t,parentClass:"."+t+" input",dataAttribute:"input["+a(h,this).fieldDataAttribute+'="'+t+'"]',name:'input[name="'+t+'"]'};return s[e]||s.name})).join(",")}function L(t){const e=document.cookie.match(new RegExp("(^| )"+t+"=([^;]+)"));return e?e[2].trim():null}function W(){let{value:t=0,units:e="minutes"}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const s={minutes:60,hours:3600,days:86400,weeks:604800,months:2592e3,years:31536e3}[e.toLowerCase()];return s?parseInt(t)*s:0}function T(){var t;const e=a(h,this).namespace;let s={utm:{source:"(direct)",medium:"(none)"}};s[e]={};const n=o(b,this,O).call(this,"utm"),i=o(b,this,O).call(this,e);n&&Object.assign(s.utm,a(d,this).utm),i&&Object.assign(s[e],a(d,this)[e]),n||i||Object.assign(s.utm,o(b,this,I).call(this)),null!==(t=a(g,this))&&void 0!==t&&t.first?s=a(g,this).last&&"(direct)"===s.utm.source?a(g,this).last:s:(a(g,this).first=s,o(b,this,Q).call(this,"first",s),s={_ref:"first"}),a(g,this).last=s,o(b,this,Q).call(this,"last",s)}function z(){console.warn("".concat(a(r,this),".js: config.enableSpaSupport = true monkeypatches the the history.pushState() method."));let t=history.pushState;history.pushState=function(e){return"function"==typeof history.onpushstate&&history.onpushstate({state:e}),t.apply(history,arguments)}}function I(){let t={};if(!a(m,this)||a(m,this).hostname.indexOf(a(h,this).storageDomain)>-1)return t;t={source:a(m,this).hostname,medium:"referral"};for(const[e,s]of Object.entries(a(h,this).parseRules)){for(const[n,i]of Object.entries(s))if(a(m,this).hostname.match(i)){t.source=n,t.medium="".concat(e);break}if(Object.keys(s).indexOf(t.medium)>-1)break}return t}function N(){if(a(h,this).storageDomain)return;const t=a(y,this).hostname;if("localhost"===t)return"";const e=t.split(".").reverse();let s=[e[1],e[0]].join(".");e.length>2&&e[1].length<=3&&(s=[e[2],s].join(".")),a(h,this).storageDomain=s}function J(t){return t.split(".").reduce(((t,e)=>t?t[e]:null),window)}function F(t){if(!t)return"";let e=String(t).trim();e=e.slice(0,255),e=e.replace(/[^a-zA-Z0-9_\-%.@+~$!:=;/|\[\]\(\) ]/g,"");return[/--|;/g,/\/\*|\*\//g].forEach((t=>{e=e.replace(t,"")})),e}function R(){let t={};const e=Math.ceil(Date.now()/1e3);for(const[n,i]of Object.entries(a(w,this))){var s;t[n]=o(b,this,K).call(this,n),"cookie"!==a(h,this).storageMethod&&(null===(s=t[n])||void 0===s?void 0:s._exp)<e&&(o(b,this,G).call(this,n),t[n]=null)}return t}function q(){const t="_".concat(a(h,this).storageNamespace,"_anonymous_id");i(l,this,o(b,this,L).call(this,t)),a(l,this)||i(l,this,"CC.1.".concat(Date.now(),".").concat(Math.floor(Math.random()*Number.MAX_SAFE_INTEGER))),"cookie"===a(h,this).storageMethod?document.cookie="".concat(t,"=").concat(a(l,this),"; max-age=").concat(o(b,this,W).call(this,{value:400,units:"days"}),"; path=/; domain=").concat(a(h,this).storageDomain,"; secure"):localStorage.setItem(t,a(l,this))}function H(){const t=a(h,this).fieldMap;for(const[e,s]of Object.entries(t))if(["first","last"].includes(e))for(const[t,n]of Object.entries(s)){let s={};a(f,this)[t].forEach((n=>{let i="$ns"===t?a(h,this).namespace:t;s[n]="".concat(i,"_").concat(n),"first"==e&&(s[n]+="_1st")}));let i=o(b,this,C).call(this,s,n);"$ns"===t?(a(h,this).fieldMap[e][a(h,this).namespace]=i,delete a(h,this).fieldMap[e][t]):a(h,this).fieldMap[e][t]=i}}function U(){let t=a(f,this).$ns,e=a(p,this).$ns;a(f,this)[a(h,this).namespace]=t,a(p,this)[a(h,this).namespace]=e,delete a(f,this).$ns,delete a(p,this).$ns}function B(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const e=a(y,this).searchParams;let s={};t=t.length>0?t:[a(h,this).namespace];for(const e of t)s[e]={};const n="stray";if(s[n]={},e){for(const[i,r]of e.entries()){let e=!1;for(const n of t)if(i.startsWith(n+"_")){const t=i.slice(n.length+1);a(f,this)[n].includes(t)&&(s[n][t]=o(b,this,F).call(this,r),e=!0);break}e||(s[n][i]=o(b,this,F).call(this,r))}i(d,this,s)}else i(d,this,s)}function Z(){let t;t=arguments.length>0&&void 0!==arguments[0]&&arguments[0]?null:document.referrer?new URL(document.referrer):null,i(m,this,t)}function G(t){const e=o(b,this,Y).call(this,t);a(g,this)[t]=null,"cookie"===a(h,this).storageMethod?document.cookie="".concat(e,"=; max-age=0; path=/; domain=").concat(a(h,this).storageDomain):localStorage.removeItem(e)}function K(t){const e=o(b,this,Y).call(this,t);let s="cookie"===a(h,this).storageMethod?o(b,this,L).call(this,e):localStorage.getItem(e);return s?(s.startsWith("$:")&&(s=atob(s.split(":")[1])),s=JSON.parse(s),"null"===s&&(s=null),s):null}function X(){let t=o(b,this,K).call(this,"last");t&&o(b,this,Q).call(this,"last",t)}function Q(t,e){const s=Math.ceil(Date.now()/1e3);e._set||(e._set=s);const[n,i]=a(w,this)[t].expires,r=o(b,this,W).call(this,{value:n,units:i});e._exp=r+s,a(g,this)[t]=e,e=JSON.stringify(e),a(h,this).storeAsBase64&&(e="$:".concat(btoa(e)));const c=o(b,this,Y).call(this,t);"cookie"===a(h,this).storageMethod?document.cookie="".concat(c,"=").concat(e,"; max-age=").concat(r,"; path=/; domain=").concat(a(h,this).storageDomain,"; secure"):localStorage.setItem(c,e)}function V(){let t=a(h,this).namespace.toLowerCase().trim();if("lvl"==t)return;[/[a-z]{2,4}/.test(t),"utm"!==t].includes(!1)&&(console.warn('Invalid namespace: Defaulting to "lvl".'),a(h,this).namespace="lvl")}function Y(t){return"_".concat(a(h,this).storageNamespace,"_").concat(t)}function tt(t){return t.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}return e=e.default})()));