!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CampaignCollector=t():e.CampaignCollector=t()}(this,(()=>(()=>{"use strict";var e={d:(t,s)=>{for(var o in s)e.o(s,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:s[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)},t={};e.d(t,{default:()=>s});class s{#e="CampaignCollector";#t="1.0.0";#s;#o=null;#n={consent:{ad_personalization:null,ad_storage:null,ad_user_data:null,analytics_storage:null},debug:!1,decorateHostnames:[],enableSpaSupport:!1,fieldMap:{anonymous_id:"$ns_anonymous_id",attribution:"$ns_attribution_json",consent:"$ns_consent_json",first:{utm:null,$ns:null},last:{utm:null,$ns:null},cookies:{},globals:{}},fieldTargetMethod:["name"],fieldDataAttribute:"data-campaign-collector",filters:{},firstPartyLeadEndpoint:null,firstPartyCookieEndpoint:null,namespace:"lvl",parseRules:{organic:{google:"^www.(google).[a-z]{2,3}(?:.[a-z]{2})?$",bing:"^www.(bing).com$",duckduckgo:"^(duckduckgo).com$",yahoo:"^(?:www|m)?.?(yahoo).(?:com|cn)$",ecosia:"^www.(ecosia).org$",ask:"^www.(ask).com$",aol:"^(?:search.)?(aol).com$",baidu:"^www.(baidu).com$",xfinity:"^my|search.(xfinity).com",yandex:"^(?:www.)?(yandex).com|ru$",lycos:"^(?:www|search)?.?(lycos).[a-z]{2,3}(?:.[a-z]{2})?$"},social:{facebook:"^www.(facebook).com$",instagram:"(instagram).com$",linkedin:"^www.(linkedin).com$",tiktok:"^www.(tiktok).com$",snapchat:"^www.(snapchat).com$",x:"^t.co|x.com$",pinterest:"^www.(pinterest).com$",reddit:"^www.(reddit).com$",quora:"^www.(quora).com$"}},sdk:null,sessionTimeout:null,storageDomain:null,storageMethod:"cookie",storageNamespace:"cc",storeAsBase64:!0,stripUtmsFromInternalLinks:!1,userDataHash:{city:!1,region:!1,postal_code:!1,country:!1}};#i=null;#a={utm:["source","medium","campaign","term","content","id","source_platform","marketing_tactic","creative_format","group","ad","product","feed","creative","extension","geo_int","geo_phy","target","network","device","matchtype","placement"],$ns:["platform","source","campaign_name","campaign","group","ad","product","feed","creative","extension","geo_int","geo_phy","target","network","device","matchtype","placement"]};#r={utm:["source","medium","campaign"],$ns:["platform","campaign","group","ad"]};#c=null;#l=null;#h={first:{expires:[400,"days"]},last:{expires:[30,"minutes"]}};#u;constructor(e={}){s.canRun()&&(console.time(this.#e),this.#u=new URL(window.location.href),this.#o=this.#d(this.#n,e),this.#m(),this.#p(),this.#f(),this.#g(),this.#y(),this.#w(),this.#b(["utm",this.#o.namespace]),Array.isArray(this.#o.sessionTimeout)&&(this.#h.last.expires=this.#o.sessionTimeout),this.#l=this.#_(),this.#$(),this.fill(),this.#k(),window.dataLayer&&window.dataLayer.push({event:`${this.#S(this.#e)}:ready`,campaign:this.grab({applyFilters:!0,without:["globals"]})}),this.#o.debug&&console.log(this.#o),console.timeEnd(this.#e))}static canRun(){return"undefined"!=typeof WeakMap&&"undefined"!=typeof URL&&"undefined"!=typeof localStorage}static create(e={},t=null){if(!s.canRun())return;const o=new s(e);return window._campaignCollector=window._campaignCollector||{},t&&!window._campaignCollector.hasOwnProperty(t)&&(window._campaignCollector[t]=o),["fill","grab","lead","debug"].reduce(((e,t)=>(e[t]=o[t].bind(o),e)),{})}static consentChange(e,t){if(!["ad_storage","ad_user_data","analytics_storage","ad_personalization"].includes(e))throw new Error("Invalid consent key.");if(!["granted","denied",null].includes(t))throw new Error('Invalid consent value. Must be "granted", "denied", or null.');const s="campaign-collector";document.dispatchEvent(new CustomEvent(`${s}:consent.change`,{detail:{type:e,status:t},bubbles:!0})),document.dispatchEvent(new Event(`${s}:${e}.${t}`,{bubbles:!0}))}get activeSession(){const e=this.#l.last;if(!e)return null;const t=Math.ceil(Date.now()/1e3);if(e._exp<t)return null;if(e._ref){const t=this.#v(e._ref);return t?{...e,[this.#o.namespace]:t[this.#o.namespace],utm:t.utm}:e}return e}get allowedFields(){return this.#a}get anonymousId(){return this.#E("analytics_storage")?this.#s:"(redacted)"}debug(){console.log(this.#o)}fill(e={}){e.hasOwnProperty("targetMethod")&&(e.targetMethod=Array.isArray(e.targetMethod)?e.targetMethod:[e.targetMethod]);const t={targetMethod:e.targetMethod||this.#o.fieldTargetMethod,scope:e.scope||document},s=this.#O(this.#o.fieldMap),o=this.grab({without:["params"],dereference:!0});["first","last"].forEach((e=>{s[e]&&(s[e]=this.#j(s[e])),o[e]&&(o[e]=this.#j(o[e]))}));for(const[e,n]of Object.entries(s))if("string"!=typeof n)for(const[s,i]of Object.entries(n)){const n=t.scope.querySelectorAll(this.#A(t.targetMethod,i));if(!n?.length)continue;let a=["cookies","globals"].includes(e)?"":"-",r=o[e][s]??a;["cookies","globals"].includes(e)&&r&&(r=this.#M(this.#o.filters[s],r)),Array.from(n).forEach((e=>{e.value||(e.value=r,e.setAttribute("value",r),e.dispatchEvent(new Event("input",{bubbles:!0})))}))}else{let s=n.replace("$ns",this.#o.storageNamespace);const o=t.scope.querySelectorAll(this.#A(t.targetMethod,s));if(o){const t={anonymous_id:this.anonymousId,consent:JSON.stringify(this.#o.consent),attribution:this.grab({asJson:!0,dereference:!0,without:["params"]})};Array.from(o).forEach((s=>{s.value=t[e],s.setAttribute("value",t[e]),s.dispatchEvent(new Event("input",{bubbles:!0}))}))}}}grab({applyFilters:e=!1,asJson:t=!1,dereference:s=!1,without:o=[]}={}){const n={namespace:this.#o.namespace};return o.includes("anonymous_id")||(n.anonymous_id=this.anonymousId),o.includes("params")||(n.params=this.#i),o.includes("first")||(n.first=this.#l.first),o.includes("last")||(n.last=this.#l.last,s&&this.#l.last._ref&&(n.last=Object.assign(this.#l[this.#l.last._ref],n.last))),o.includes("globals")||(n.globals=this.#x({applyFilters:e})),o.includes("cookies")||(n.cookies=this.#E("ad_user_data")?this.#C({applyFilters:e}):{}),t?JSON.stringify(n):n}async#L(e){const t=(new TextEncoder).encode(e),s=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(s)).map((e=>e.toString(16).padStart(2,"0"))).join("")}lead(e={},t={}){if(!this.#o.firstPartyLeadEndpoint)throw new Error("`firstPartyLeadEndpoint` is required to send lead payload.");let s={anonymous_id:this.anonymousId,sent_at:(new Date).getTime(),event:"lead",consent:this.#o.consent,context:{attribution:this.grab({without:["anonymous_id","params","globals"]}),locale:navigator.language,page:{title:document.title,url:location.href,referrer:document.referrer},screen:{width:screen.width,height:screen.height,inner_width:innerWidth,inner_height:innerHeight},sdk:`${this.#e}@${this.#t}`,user_agent:navigator.userAgent}};this.#o.sdk&&(s.context.sdk+=`/${this.#o.sdk}`),Object.keys(e).forEach((t=>{/^[a-z_]+$/.test(t)||(console.warn(`${this.#e}.js: Removing "${t}" from lead payload. Keys must be in snake_case format.`),delete e[t])})),Object.keys(e).length>0&&(s.properties=e),["first_name","last_name","email","phone","city","region","postal_code","country","date_of_birth","gender"].forEach((e=>{t[e]&&(s.hasOwnProperty("user")||(s.user={}),s.user[e]=t[e].trim().toLowerCase(),delete t[e])})),this.#P(`https://${this.#o.firstPartyLeadEndpoint}`,s)}async#P(e,t){if(t.user){const e=[...Object.keys(this.#o.userDataHash).filter((e=>this.#o.userDataHash[e])),"first_name","last_name","email","phone","date_of_birth","gender"],s={},o={first_name:e=>e.replace(/[^a-z]/g,""),last_name:e=>e.replace(/[^a-z]/g,""),email:e=>{let[t,o]=e.split("@");s.email_domain=o;let n=[e];return["gmail.com","googlemail.com"].includes(o)&&(t=t.replace(/\./g,""),t=t.split("+")[0],n.push(t+"@"+o)),n},phone:e=>{if((e=e.replace(/[^0-9]/g,"")).length<10||e.length>11)return null;if("1"!==e[0]&&11===e.length)return null;const t=[e=10===e.length?`1${e}`:`${e}`,`+${e}`];return s.phone_area_code=e.substring(1,4),t},city:e=>e.replace(/[^a-z]/g,""),postal_code:e=>e.replace(/[^0-9]/g,"").substring(0,5),date_of_birth:e=>{const t=new Date(e);return s.age=`${Math.floor((new Date-t)/315576e5)}`,t.toISOString().split("T")[0].replace("-","")},gender:e=>e.substring(0,1)},n=(await Promise.all(Object.entries(t.user).map((async([t,s])=>{if(!s)return null;let n=o[t]?o[t](s):s;if(!n)return null;if(Array.isArray(n)){const s=await Promise.all(n.map((async s=>e.includes(t)?await this.#L(s):s)));return s.some((e=>e))?[t,s]:null}{const s=e.includes(t)?await this.#L(n):n;return s?[t,s]:null}})))).filter((e=>null!==e));n.length>0?t.user=Object.assign(Object.fromEntries(n),s):t.user={}}this.#o.debug&&console.log("Sending payload:",t),fetch(e,{method:"POST",body:btoa(JSON.stringify(t)),keepalive:!0})}#M(e,t){if("function"!=typeof e)return t;try{t=e(t)}catch(e){console.error(`${this.#e}.js: Error applying filter.`,e.message)}return t}#k(){if(this.#o.enableSpaSupport){this.#I();const e=e=>{this.#y(!0),this.#$()};window.addEventListener("popstate",e),window.onpopstate=history.onpushstate=e}if(this.#o.stripUtmsFromInternalLinks){const e=e=>{const t=e.target.closest("a[href]");if(!t)return;const s=new URL(t.href);s.hostname===this.#u.hostname&&s.search.includes("utm_")&&(this.#a.utm.forEach((e=>{s.searchParams.delete(`utm_${e}`)})),t.href=s.href)};document.addEventListener("touchstart",e),document.addEventListener("mousedown",e)}const e=((e,t)=>{let s,o=!0;return function(...n){if(o)return o=!1,void e(...n);clearTimeout(s),s=setTimeout((()=>{clearTimeout(s),e(...n)}),t)}})((e=>{const t=e.target.closest("form");t&&this.fill(t)}),1500);["mousedown","touchstart"].forEach((t=>{document.addEventListener(t,(t=>{e(t),this.#N()}))}));const t=this.#S(this.#e);document.addEventListener(`${t}:consent.change`,(e=>{const{type:t,status:s}=e.detail;this.#D(t,s)}))}#F(e){const t=this.#i[e];if(!Object.keys(t).length)return;const s=this.#r[e];for(const e of s)if(!t.hasOwnProperty(e))return!1;return!0}#C({applyFilters:e=!1}={}){let t={};if(!this.#o.fieldMap.cookies)return t;for(const[s,o]of Object.entries(this.#o.fieldMap.cookies)){let o=this.#R(s);o&&(e&&(o=this.#M(this.#o.filters[s],o)),t[s]=o)}return t}#x({applyFilters:e=!1}={}){let t={};for(const[s,o]of Object.entries(this.#o.fieldMap.globals))try{let o=this.#z(s);if(!o)continue;e&&(o=this.#M(this.#o.filters[s],o)),t[s]=o}catch(e){console.error(`${this.#e}.js: Error resolving global "${s}"`,e.message)}return t}#E(e){return{granted:!0,denied:!1,null:!0,null:!0}[this.#o.consent[e]]}#D(e,t){this.#o.consent[e]=t?t.toLowerCase():null}#O(e){return JSON.parse(JSON.stringify(e))}#d(e,t){for(const s in t)t.hasOwnProperty(s)&&(Array.isArray(t[s])?e[s]=t[s].slice():"object"==typeof t[s]&&null!==t[s]?(e[s]||(e[s]={}),this.#d(e[s],t[s])):e[s]=t[s]);return e}#j(e,t=""){return Object.keys(e).reduce(((s,o)=>{const n=t.length?`${t}_`:"";return"object"!=typeof e[o]||null===e[o]||Array.isArray(e[o])?s[`${n}${o}`]=e[o]:Object.assign(s,this.#j(e[o],`${n}${o}`)),s}),{})}#A(e=[],t){return e.map((e=>{const s={class:"input."+t,parentClass:"."+t+" input",dataAttribute:"input["+this.#o.fieldDataAttribute+'="'+t+'"]',name:'input[name="'+t+'"]'};return s[e]||s.name})).join(",")}#R(e){const t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]+)"));return t?t[2].trim():null}#T({value:e=0,units:t="minutes"}={}){const s={minutes:60,hours:3600,days:86400,weeks:604800,months:2592e3,years:31536e3}[t.toLowerCase()];return s?parseInt(e)*s:0}#$(){const e=this.#l.last;e&&e._exp<Math.ceil(Date.now()/1e3)&&this.#U("last");const t=this.#o.namespace;let s={utm:{source:"(direct)",medium:"(none)"}};s[t]={};const o=this.#F("utm"),n=this.#F(t);if(o||n)o&&Object.assign(s.utm,this.#i.utm),n&&Object.assign(s[t],this.#i[t]);else{const e=this.activeSession,o=(e,t)=>!(!e||!this.#r[t])&&this.#r[t].every((s=>e[t]?.[s]&&(!["utm"].includes(t)||"source"===s&&"(direct)"!==e[t][s]||"medium"===s&&"(none)"!==e[t][s]))),n=o(e,"utm"),i=o(e,t);n||i?s=e:Object.assign(s.utm,this.#G())}this.#l?.first?s=this.#l.last&&"(direct)"===s.utm.source?this.#l.last:s:(this.#l.first=s,this.#H("first",s),s={_ref:"first"}),this.#l.last=s,this.#H("last",s)}#I(){console.warn(`${this.#e}.js: config.enableSpaSupport = true monkeypatches the the history.pushState() method.`);let e=history.pushState;history.pushState=function(t){return"function"==typeof history.onpushstate&&history.onpushstate({state:t}),e.apply(history,arguments)}}#G(){let e={};if(!this.#c||this.#c.hostname.indexOf(this.#o.storageDomain)>-1)return e;e={source:this.#c.hostname,medium:"referral"};for(const[t,s]of Object.entries(this.#o.parseRules)){for(const[o,n]of Object.entries(s))if(this.#c.hostname.match(n)){e.source=o,e.medium=`${t}`;break}if(Object.keys(s).indexOf(e.medium)>-1)break}return e}#f(){if(this.#o.storageDomain)return;const e=this.#u.hostname;if("localhost"===e)return"";const t=e.split(".").reverse();let s=[t[1],t[0]].join(".");t.length>2&&t[1].length<=3&&(s=[t[2],s].join(".")),this.#o.storageDomain=s}#z(e){return e.split(".").reduce(((e,t)=>e?e[t]:null),window)}#J(e){if(!e)return"";let t=String(e).trim();t=t.slice(0,255),t=t.replace(/[^a-zA-Z0-9_\-%.@+~$!:=;/|\[\]\(\) ]/g,"");return[/--|;/g,/\/\*|\*\//g].forEach((e=>{t=t.replace(e,"")})),t}#_(){let e={};const t=Math.ceil(Date.now()/1e3);for(const[s,o]of Object.entries(this.#h))e[s]=this.#v(s),"cookie"!==this.#o.storageMethod&&e[s]?._exp<t&&(this.#U(s),e[s]=null);return e}#g(){const e=`_${this.#o.storageNamespace}_anonymous_id`;this.#s=this.#R(e),this.#s||(this.#s=`CC.1.${Date.now()}.${Math.floor(Math.random()*Number.MAX_SAFE_INTEGER)}`),"cookie"===this.#o.storageMethod?document.cookie=`${e}=${this.#s}; max-age=${this.#T({value:400,units:"days"})}; path=/; domain=${this.#o.storageDomain}; secure`:localStorage.setItem(e,this.#s)}#p(){const e=this.#o.fieldMap;for(const[t,s]of Object.entries(e))if(["first","last"].includes(t))for(const[e,o]of Object.entries(s)){let s={};this.#a[e].forEach((o=>{let n="$ns"===e?this.#o.namespace:e;s[o]=`${n}_${o}`,"first"==t&&(s[o]+="_1st")}));let n=this.#d(s,o);"$ns"===e?(this.#o.fieldMap[t][this.#o.namespace]=n,delete this.#o.fieldMap[t][e]):this.#o.fieldMap[t][e]=n}}#w(){let e=this.#a.$ns,t=this.#r.$ns;this.#a[this.#o.namespace]=e,this.#r[this.#o.namespace]=t,delete this.#a.$ns,delete this.#r.$ns}#b(e=[]){const t=this.#u.searchParams;let s={};e=e.length>0?e:[this.#o.namespace];for(const t of e)s[t]={};const o="stray";if(s[o]={},t){for(const[n,i]of t.entries()){let t=!1;for(const o of e)if(n.startsWith(o+"_")){const e=n.slice(o.length+1);this.#a[o].includes(e)&&(s[o][e]=this.#J(i),t=!0);break}t||(s[o][n]=this.#J(i))}this.#i=s}else this.#i=s}#y(e=!1){let t;t=e?null:document.referrer?new URL(document.referrer):null,this.#c=t}#U(e){const t=this.#K(e);this.#l[e]=null,"cookie"===this.#o.storageMethod?document.cookie=`${t}=; max-age=0; path=/; domain=${this.#o.storageDomain}`:localStorage.removeItem(t)}#v(e){const t=this.#K(e);let s="cookie"===this.#o.storageMethod?this.#R(t):localStorage.getItem(t);return s?(s.startsWith("$:")&&(s=atob(s.split(":")[1])),s=JSON.parse(s),"null"===s&&(s=null),s):null}#N(){let e=this.#v("last");e&&this.#H("last",e)}#H(e,t){const s=Math.ceil(Date.now()/1e3);t._set||(t._set=s);const[o,n]=this.#h[e].expires,i=this.#T({value:o,units:n});t._exp=i+s,this.#l[e]=t,t=JSON.stringify(t),this.#o.storeAsBase64&&(t=`$:${btoa(t)}`);const a=this.#K(e);"cookie"===this.#o.storageMethod?document.cookie=`${a}=${t}; max-age=${i}; path=/; domain=${this.#o.storageDomain}; secure`:localStorage.setItem(a,t)}#m(){let e=this.#o.namespace.toLowerCase().trim();if("lvl"==e)return;[/[a-z]{2,4}/.test(e),"utm"!==e].includes(!1)&&(console.warn('Invalid namespace: Defaulting to "lvl".'),this.#o.namespace="lvl")}#K(e){return`_${this.#o.storageNamespace}_${e}`}#S(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}}return t=t.default})()));